(function(){"use strict";const H=t=>{const u=t*180/Math.PI;return parseFloat(u.toFixed(1))},yt=t=>t*Math.PI/180,Q=t=>{const{top_diameter:u,bottom_diameter:a,height:g,gap_angle:n}=t,s=u,o=a,v=g,w=Math.sqrt(Math.pow(s,2)/4+Math.pow(s*v/(s-o),2)),m=Math.sqrt(Math.pow(o,2)/4+Math.pow(o*v/(s-o),2)),y=Math.PI*s/w,b=y*180/Math.PI,M=n/360*b,k=yt(M);return{R:w,r:m,fi_rad:y,gap_rad:k}},bt=t=>{const{R:u,r:a,fi_rad:g,gap_rad:n}=Q(t),s=g-n,o=u*Math.sin(s/2)*2,v=u-a*Math.cos(s/2);return{width:o,height:v}};function G(t){return"side"in t}function J(t){return"width"in t&&"height"in t&&!("border_radius"in t)&&!("border_radius_tl"in t)&&!("path"in t)}function A(t){return"width"in t&&"height"in t&&"border_radius"in t}function j(t){return"width"in t&&"height"in t&&("border_radius_tl"in t&&"border_radius_tr"in t&&"border_radius_bl"in t&&"border_radius_br"in t||"border_radius"in t)}function tt(t){return"radius"in t}function et(t){return"top_radius"in t&&"bottom_radius"in t}function rt(t){return"vertical_axis"in t&&"horizontal_axis"in t}function it(t){return"width"in t&&"height"in t&&"path"in t}const wt=t=>{let u={width:0,height:0};if(G(t)){const{side:a}=t;({...t},u={width:a,height:a})}if(J(t)){const{width:a,height:g}=t;u={width:a,height:g},{...t}}if(A(t)){const{width:a,height:g}=t;u={width:a,height:g},{...t}}if(j(t)){const{width:a,height:g}=t;u={width:a,height:g},{...t}}if(tt(t)){const{radius:a}=t;u={width:2*a,height:2*a},{...t}}if(et(t)){const{top_radius:a,bottom_radius:g,height:n,gap_angle:s}=t,o={top_diameter:a,bottom_diameter:g,height:n,gap_angle:H(s)};u=bt(o),{...t}}if(rt(t)){const{horizontal_axis:a,vertical_axis:g}=t;u={width:a,height:g},{...t}}if(it(t)){const{width:a,height:g}=t;u={width:a,height:g},{...t}}return u},Mt=t=>{let u=null;if(u=G(t)?"square":J(t)?"rect":A(t)?"round-corners":j(t)?"round-corners-2":tt(t)?"circle":et(t)?"cone":rt(t)?"ellipse":it(t)?"path":null,u===null)throw new Error("Invalid printareaprops value");return u};function xt(t){return typeof t!="string"?!1:(t=t.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(t)&&/[\dz]$/i.test(t)&&t.length>4))}function kt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var W,nt;function zt(){if(nt)return W;nt=1;var t=[];return t[97]=7,t[99]=6,t[104]=1,t[108]=2,t[109]=2,t[113]=4,t[115]=4,t[116]=2,t[118]=1,t[122]=0,W=function(a){var g=a.length,n,s,o,v,w=0,m=!1,y="",b,M=!1,k=!1,e=[],r=[],h=[];function p(d){h.push({position:n,segment:e.length+1,message:d})}for(n=0;n<=g;n++)if(s=a[n]||"z",o=s.toLowerCase().charCodeAt(0),!(48<=o&&o<=57&&(y+=s,m=!0,r[0]!=="A"&&r[0]!=="a"||o>49||w<3||w>4))){if((o===45||o===43)&&(!m||k&&y[y.length-1]==="e")){y+=s,m=!0;continue}if(o===46&&!M&&!k){y+=s,m=!0,M=!0;continue}if(o===101&&m&&!isNaN(y)){y+="e",m=!0,k=!0;continue}if(m&&(v?(b=+y,isNaN(y)?p("Bad formated number ["+y+"]. I'll ignore it."):(r.push(b),w++)):p("Non expected number ["+y+"] at this place. I'll ignore it."),y="",m=k=M=!1),w===v&&r.length)switch((r[0]==="A"||r[0]==="a")&&(r[4]=r[4]?1:0,r[5]=r[5]?1:0),e.length===0&&r[0]!=="m"&&r[0]!=="M"&&(p("The path must start with M or m. I add 'M 0 0' for you."),e.push(["M",0,0])),e.push(r),w=0,r[0]){case"M":r=["L"];break;case"m":r=["l"];break;case"Z":case"z":r=[];break;default:r=[r[0]]}if(!(o===32||o===9||o===10||o===13||o===44)){if(o===43||o===45||o===46){y=s,M=o===46,m=!0;continue}if(!t.hasOwnProperty(o)){p("Non expected character ["+s+"]. I'll ignore it.");continue}v=t[o],r.length>1&&p("Non complete segment ["+r.join(" ")+"]. I'll ignore it."),r=[s],w=0}}return r.length>1&&p("Non complete segment ["+r.join(" ")+"] (at the end of the path). I'll ignore it."),{errs:h,segments:e}},W}var I,at;function ot(){if(at)return I;at=1;function t(a,g){return[a[0]*g[0]+a[2]*g[1],a[1]*g[0]+a[3]*g[1],a[0]*g[2]+a[2]*g[3],a[1]*g[2]+a[3]*g[3],a[0]*g[4]+a[2]*g[5]+a[4],a[1]*g[4]+a[3]*g[5]+a[5]]}function u(a){if(!(this instanceof u))return new u(a);if(!a)a=[];else switch(a.constructor){case String:a=a.trim().split(/\s+/).map(parseFloat);break;case u:a=a.toArray();break;case Array:break;default:a=[]}this.matrix=a.slice().concat([1,0,0,1,0,0].slice(a.length))}return u.prototype.copy=function(a){return new u(this.matrix)},u.prototype.isIdentity=function(a){return a?(this.matrix[0]-1)*(this.matrix[0]-1)+this.matrix[1]*this.matrix[1]+this.matrix[2]*this.matrix[2]+(this.matrix[3]-1)*(this.matrix[3]-1)+this.matrix[4]*this.matrix[4]+this.matrix[5]*this.matrix[5]<a:this.matrix[0]===1&&this.matrix[1]===0&&this.matrix[2]===0&&this.matrix[3]===1&&this.matrix[4]===0&&this.matrix[5]===0},u.prototype.preserveH=function(){return!this.matrix[1]},u.prototype.preserveV=function(){return!this.matrix[2]},u.prototype.det=function(){return this.matrix[0]*this.matrix[3]-this.matrix[1]*this.matrix[2]},u.prototype.reset=function(){return this.matrix=[1,0,0,1,0,0],this},u.prototype.compose=function(a){return(!a||a.constructor!==u)&&(a=new u(a)),a.isIdentity()?this:(this.matrix=t(a.matrix,this.matrix),this)},u.prototype.translate=function(a,g){return this.matrix[4]+=a,this.matrix[5]+=g,this},u.prototype.scale=function(a,g){return(a!==1||g!==1)&&(this.matrix[0]*=a,this.matrix[2]*=a,this.matrix[4]*=a,this.matrix[1]*=g,this.matrix[3]*=g,this.matrix[5]*=g),this},u.prototype.rotate=function(a,g,n){var s,o,v;return a!==0&&(s=a*Math.PI/180,o=Math.cos(s),v=Math.sin(s),this.translate(-g,-n).compose([o,v,-v,o,0,0]).translate(g,n)),this},u.prototype.skewX=function(a){return a!==0&&this.compose([1,0,Math.tan(a*Math.PI/180),1,0,0]),this},u.prototype.skewY=function(a){return a!==0&&this.compose([1,Math.tan(a*Math.PI/180),0,1,0,0]),this},u.prototype.toArray=function(){return this.matrix},u.prototype.calc=function(a,g,n){return[this.matrix[0]*a+this.matrix[2]*g+(n?0:this.matrix[4]),this.matrix[1]*a+this.matrix[3]*g+(n?0:this.matrix[5])]},I=u,I}var F,st;function St(){if(st)return F;st=1;var t=ot(),u={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},a=/\s*((?:matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(?:.+?)\s*\))[\s,]*/,g=/[\s(),]+/;return F=function(s){var o=t(),v,w,m;v=s.split(a).filter(Boolean);for(var y=v.length-1;y>=0;y--)if(m=v[y].split(g).filter(Boolean),!(m.length<2))switch(w=m.shift(),u[w]&&(m=m.map(parseFloat)),w){case"matrix":(m.length===6||m.length===4)&&o.compose(m);break;case"scale":m.length===1?o.scale(m[0],m[0]):m.length===2&&o.scale(m[0],m[1]);break;case"rotate":m.length===1?o.rotate(m[0],0,0):m.length===3&&o.rotate(m[0],m[1],m[2]);break;case"translate":m.length===1?o.translate(m[0],0):m.length===2&&o.translate(m[0],m[1]);break;case"skewX":m.length===1&&o.skewX(m[0]);break;case"skewY":m.length===1&&o.skewY(m[0]);break}return o},F}var $,ht;function Yt(){if(ht)return $;ht=1;var t=Math.PI*2;function u(n,s,o,v){var w=n*v-s*o<0?-1:1,m=n*o+s*v;return m>1&&(m=1),m<-1&&(m=-1),w*Math.acos(m)}function a(n,s,o,v,w,m,y,b,M,k){var e=k*(n-o)/2+M*(s-v)/2,r=-M*(n-o)/2+k*(s-v)/2,h=y*y,p=b*b,d=e*e,f=r*r,i=h*p-h*f-p*d;i<0&&(i=0),i/=h*f+p*d,i=Math.sqrt(i)*(w===m?-1:1);var c=i*y/b*r,l=i*-b/y*e,_=k*c-M*l+(n+o)/2,x=M*c+k*l+(s+v)/2,S=(e-c)/y,z=(r-l)/b,Y=(-e-c)/y,X=(-r-l)/b,E=u(1,0,S,z),T=u(S,z,Y,X);return m===0&&T>0&&(T-=t),m===1&&T<0&&(T+=t),[_,x,E,T]}function g(n,s){var o=1.3333333333333333*Math.tan(s/4),v=Math.cos(n),w=Math.sin(n),m=Math.cos(n+s),y=Math.sin(n+s);return[v,w,v-w*o,w+v*o,m+y*o,y-m*o,m,y]}return $=function(s,o,v,w,m,y,b,M,k){var e=Math.sin(k*t/360),r=Math.cos(k*t/360),h=r*(s-v)/2+e*(o-w)/2,p=-e*(s-v)/2+r*(o-w)/2;if(h===0&&p===0)return[];if(b===0||M===0)return[];b=Math.abs(b),M=Math.abs(M);var d=h*h/(b*b)+p*p/(M*M);d>1&&(b*=Math.sqrt(d),M*=Math.sqrt(d));var f=a(s,o,v,w,m,y,b,M,e,r),i=[],c=f[2],l=f[3],_=Math.max(Math.ceil(Math.abs(l)/(t/4)),1);l/=_;for(var x=0;x<_;x++)i.push(g(c,l)),c+=l;return i.map(function(S){for(var z=0;z<S.length;z+=2){var Y=S[z+0],X=S[z+1];Y*=b,X*=M;var E=r*Y-e*X,T=e*Y+r*X;S[z+0]=E+f[0],S[z+1]=T+f[1]}return S})},$}var N,ct;function Xt(){if(ct)return N;ct=1;var t=Math.PI/180;function u(a,g,n,s){if(!(this instanceof u))return new u(a,g,n,s);this.rx=a,this.ry=g,this.ax=n,this.epsilon=typeof s>"u"?1e-7:+("1e"+-s)}return u.prototype.transform=function(a){var g=Math.cos(this.ax*t),n=Math.sin(this.ax*t),s=[this.rx*(a[0]*g+a[2]*n),this.rx*(a[1]*g+a[3]*n),this.ry*(-a[0]*n+a[2]*g),this.ry*(-a[1]*n+a[3]*g)],o=s[0]*s[0]+s[2]*s[2],v=s[1]*s[1]+s[3]*s[3],w=Math.sqrt(((s[0]-s[3])*(s[0]-s[3])+(s[2]+s[1])*(s[2]+s[1]))*((s[0]+s[3])*(s[0]+s[3])+(s[2]-s[1])*(s[2]-s[1]))),m=(o+v)/2;if(w<=this.epsilon)return this.rx=this.ry=Math.sqrt(m),this.ax=0,this;if(Math.abs(w-Math.abs(o-v))<=this.epsilon)return this.rx=Math.sqrt(o),this.ry=Math.sqrt(v),this.ax=0,this;var y=s[0]*s[1]+s[2]*s[3],b=m+w/2,M=m-w/2;return Math.abs(y)<=this.epsilon&&Math.abs(b-v)<=this.epsilon?(this.ax=0,this.rx=Math.sqrt(M),this.ry=Math.sqrt(b),this):(this.ax=Math.atan(Math.abs(y)>Math.abs(b-v)?(b-o)/y:y/(b-v))/t,this.ax>=0?(this.rx=Math.sqrt(b),this.ry=Math.sqrt(M)):(this.ax+=90,this.rx=Math.sqrt(M),this.ry=Math.sqrt(b)),this)},u.prototype.isDegenerate=function(){return Math.abs(this.rx)<=this.epsilon||Math.abs(this.ry)<=this.epsilon},u.prototype.normalise=function(a,g){if(this.rx=Math.abs(this.rx),this.ry=Math.abs(this.ry),Math.abs(this.rx-this.ry)<=this.epsilon)this.ax=0,this.rx=this.ry=(this.rx+this.ry)/2;else if(this.ax=this.ax%180,this.ax<0&&(this.ax+=180),this.ax>=90){var n;n=this.rx,this.rx=this.ry,this.ry=n,this.ax=this.ax-90}if(!a&&!g)return this;var s=Math.cos(this.ax*t),o=Math.sin(-this.ax*t),v=(a*s-g*o)/this.rx,w=(a*o+g*s)/this.ry,m=Math.sqrt(v*v+w*w);return m>1&&(this.rx*=m,this.ry*=m),this},N=u,N}var O,ft;function Tt(){if(ft)return O;ft=1;function t(n){if(!(this instanceof t))return new t(n);if(n&&n.constructor===String){var s=n.trim().split(/\s+/).map(parseFloat);this.addX(s[0]).addX(s[0]+s[2]).addY(s[1]).addY(s[1]+s[3])}return this}t.prototype.copy=function(){var n=new t;return n.minX=this.minX,n.minY=this.minY,n.maxX=this.maxX,n.maxY=this.maxY,n},t.prototype.width=function(){return typeof this.minX>"u"?0:this.maxX-this.minX},t.prototype.height=function(){return typeof this.minY>"u"?0:this.maxY-this.minY},t.prototype.isUndefined=function(){return typeof this.minX>"u"||typeof this.minY>"u"},t.prototype.addX=function(n){return typeof this.minX>"u"?this.minX=this.maxX=n:(this.minX=Math.min(this.minX,n),this.maxX=Math.max(this.maxX,n)),this},t.prototype.addY=function(n){return typeof this.minY>"u"?this.minY=this.maxY=n:(this.minY=Math.min(this.minY,n),this.maxY=Math.max(this.maxY,n)),this},t.prototype.addPoint=function(n,s){return this.addX(n).addY(s)};function u(n){var s=Math.min(n[0],n[2]),o=Math.max(n[0],n[2]);if(n[1]>n[0]?n[2]>=n[1]:n[2]<=n[1])return[s,o];var v=(n[0]*n[2]-n[1]*n[1])/(n[0]-2*n[1]+n[2]);return v<s?[v,o]:[s,v]}t.prototype.addXQ=function(n){var s=u(n);return this.addX(s[0]).addX(s[1])},t.prototype.addYQ=function(n){var s=u(n);return this.addY(s[0]).addY(s[1])};var a=1e-8;function g(n){var s=n[0]-3*n[1]+3*n[2]-n[3];if(Math.abs(s)<a)return u([n[0],-.5*n[0]+1.5*n[1],n[0]-3*n[1]+3*n[2]]);var o=-n[0]*n[2]+n[0]*n[3]-n[1]*n[2]-n[1]*n[3]+n[1]*n[1]+n[2]*n[2];if(o<=0)return[Math.min(n[0],n[3]),Math.max(n[0],n[3])];for(var v=Math.sqrt(o),w=Math.max(n[0],n[3]),m=Math.min(n[0],n[3]),y=n[0]-2*n[1]+n[2],b=(y+v)/s,M=1;M<=2;b=(y-v)/s,M++)if(b>0&&b<1){var k=n[0]*(1-b)*(1-b)*(1-b)+n[1]*3*(1-b)*(1-b)*b+n[2]*3*(1-b)*b*b+n[3]*b*b*b;k<m&&(m=k),k>w&&(w=k)}return[m,w]}return t.prototype.addXC=function(n){var s=g(n);return this.addX(s[0]).addX(s[1])},t.prototype.addYC=function(n){var s=g(n);return this.addY(s[0]).addY(s[1])},t.prototype.toArray=function(){return this.isUndefined()?[0,0,0,0]:[this.minX,this.minY,this.maxX,this.maxY]},t.prototype.toString=function(n){return this.isUndefined()?"0 0 0 0":(typeof n>"u"?[this.minX,this.minY,this.width(),this.height()]:[this.minX.toFixed(n),this.minY.toFixed(n),this.width().toFixed(n),this.height().toFixed(n)]).join(" ")},t.prototype.inboxMatrix=function(n){var s=new t(n.match(/(-|\d|\.|\s)+/)[0]),o=(n+"meet").match(/(fit|none|meet|slice|move)/)[0];o==="none"&&(o="fit");var v,w;switch(o){case"fit":v=this.width()?s.width()/this.width():1,w=this.height()?s.height()/this.height():1;break;case"slice":if(this.width()!==0&&this.height()!==0){v=w=Math.max(s.width()/this.width(),s.height()/this.height());break}case"meet":v=w=this.width()===0&&this.height()===0?1:Math.min(s.width()/this.width(),s.height()/this.height());break;case"move":v=w=1;break}var m={};m.X=(n+"xMid").match(/x(Min|Mid|Max)/i)[1].toLowerCase(),m.Y=(n+"YMid").match(/Y(Min|Mid|Max)/i)[1].toLowerCase();var y={},b={};b.src=this,b.dst=s;for(var M="X",k=1;k<=2;M="Y",k++)for(var e="src",r=1;r<=2;e="dst",r++)switch(m[M]){case"min":y[e+M]=b[e]["min"+M];break;case"mid":y[e+M]=(b[e]["min"+M]+b[e]["max"+M])/2;break;case"max":y[e+M]=b[e]["max"+M];break}return[v,0,0,w,y.dstX-v*y.srcX,y.dstY-w*y.srcY]},O=t,O}var K,ut;function Lt(){if(ut)return K;ut=1;var t=zt(),u=St(),a=ot(),g=Yt(),n=Xt(),s=Tt();function o(e){if(!(this instanceof o))return new o(e);var r=t(e);this.segments=r.segments,this.errs=r.errs,this.affineTransform=a()}o.prototype.precision=7,o.prototype.copy=function(){for(var e=new o(""),r=0,h=this.segments.length;r<h;r++)e.segments[r]=this.segments[r].slice(0);return e.errs=this.errs,e.affineTransform=this.affineTransform.copy(),e},o.prototype.hasErrors=function(){return this.errs.length>0},o.prototype.errors=function(){var e=[],r=this.errs.length,h;for(h=0;h<r;h++)e.push("[pos:"+this.errs[h].position+", seg:"+this.errs[h].segment+"] "+this.errs[h].message);return e.join(`
`)},o.prototype.toArray=function(e){return e=!!e,this.doTransform().round(this.precision),e&&this.hasErrors()?this.segments.concat.apply([],this.segments.slice(0,this.errs[0].segment-1)):this.segments.concat.apply([],this.segments)};function v(e,r){if(e.length<=1)return null;var h=[0,0],p;switch(e[0]){case"h":case"H":h[0]=e[1],h[1]=e[0]==="h"?0:r[1];break;case"v":case"V":h[0]=e[0]==="v"?0:r[0],h[1]=e[1];break;default:p=e.length-2,h[0]=e[p],h[1]=e[p+1]}return e[0]===e[0].toLowerCase()&&(h[0]+=r[0],h[1]+=r[1]),h}o.prototype.iterate=function(e){var r=this,h=this.segments,p=[],d=[],f=[0,0],i=[0,0];if(h.forEach(function(_,x){var S=f[0],z=f[1],Y;_[0]==="z"||_[0]==="Z"?f=i.slice():(f=v(_,f),(_[0]==="m"||_[0]==="M")&&(i=f.slice())),Y=e.call(r,_,x,S,z),Array.isArray(Y)&&(p[x]=Y)}),p.length===0)return this;for(var c=0,l=h.length;c<l;c++)typeof p[c]<"u"?d.push.apply(d,p[c]):d.push(h[c]);return this.segments=d,this};function w(e,r){e.iterate(function(h,p,d,f){var i,c,l,_;switch(h[0]){case"v":i=r.calc(0,h[1],!0),c=r.preserveV()?["v",i[1]]:["l",i[0],i[1]];break;case"V":i=r.calc(d,h[1],!1),c=r.preserveV()?["V",i[1]]:["L",i[0],i[1]];break;case"h":i=r.calc(h[1],0,!0),c=r.preserveH()?["h",i[0]]:["l",i[0],i[1]];break;case"H":i=r.calc(h[1],f,!1),c=r.preserveH()?["H",i[0]]:["L",i[0],i[1]];break;case"a":case"A":var x=n(h[1],h[2],h[3],this.precision).transform(r.toArray());i=r.calc(h[6],h[7],h[0]==="a"),x.isDegenerate()?c=[h[0]==="a"?"l":"L",i[0],i[1]]:(r.det()<0&&(h[5]=h[5]?0:1),c=[h[0],x.rx,x.ry,x.ax,h[4],h[5],i[0],i[1]]);break;default:l=h[0],c=[l],_=l.toLowerCase()===l&&p;for(var S=1,z=h.length;S<z;S+=2)i=r.calc(h[S],h[S+1],_),c.push(i[0],i[1])}return[c]})}o.prototype.doTransform=function(){return this.affineTransform.isIdentity()?this:(w(this,this.affineTransform),this.affineTransform.reset(),this)},o.prototype.translate=function(e,r){return this.affineTransform.translate(e,r||0),this},o.prototype.scale=function(e,r){return this.affineTransform.scale(e,isNaN(r)?e:r),this},o.prototype.rotate=function(e,r,h){return this.affineTransform.rotate(e,r||0,h||0),this},o.prototype.skewX=function(e){return this.affineTransform.skewX(e),this},o.prototype.skewY=function(e){return this.affineTransform.skewY(e),this},o.prototype.matrix=function(e){return this.affineTransform.compose(e),this},o.prototype.transform=function(e){return e.trim()?(this.affineTransform.compose(u(e)),this):this};function m(e,r){return r=~~r,r===0?Math.round(e):(e=+e,isNaN(e)?NaN:(e=e.toString().split("e"),e=Math.round(+e[0]+"e"+(~~e[1]+r)),e=e.toString().split("e"),+(e[0]+"e"+(~~e[1]-r))))}o.prototype.round=function(e){this.precision=e=~~e;var r=0,h=0,p=0,d=0;return this.doTransform(),this.segments.forEach(function(f){var i=f[0].toLowerCase()===f[0],c,l,_;switch(f[0]){case"H":case"h":i&&(f[1]+=p),c=f[1],f[1]=m(c,e),p=c-f[1];return;case"V":case"v":i&&(f[1]+=d),l=f[1],f[1]=m(l,e),d=l-f[1];return;case"Z":case"z":p=r,d=h;return;case"A":case"a":f[1]=m(f[1],e),f[2]=m(f[2],e),f[3]=m(f[3],e+2),i&&(f[6]+=p,f[7]+=d),c=f[6],l=f[7],f[6]=m(c,e),f[7]=m(l,e),p=c-f[6],d=l-f[7];return;default:for(_=f.length-3,i&&(f[_+1]+=p,f[_+2]+=d),c=f[_+1],l=f[_+2],f[_+1]=m(c,e),f[_+2]=m(l,e),p=c-f[_+1],d=l-f[_+2];_>0;_--)f[_]=m(f[_],e);f[0].toLowerCase()==="m"&&(r=p,h=d);return}}),this},o.prototype.abs=function(){return this.iterate(function(e,r,h,p){var d=e[0],f=d.toUpperCase();if(d!==f)switch(e[0]=f,d){case"v":e[1]+=p;return;case"a":e[6]+=h,e[7]+=p;return;default:for(var i=1,c=e.length;i<c;i++)e[i]+=i%2?h:p}}),this},o.prototype.rel=function(){return this.iterate(function(e,r,h,p){var d=e[0],f=d.toLowerCase();if(d!==f&&!(r===0&&d==="M"))switch(e[0]=f,d){case"V":e[1]-=p;return;case"A":e[6]-=h,e[7]-=p;return;default:for(var i=1,c=e.length;i<c;i++)e[i]-=i%2?h:p}}),this},o.prototype.unarc=function(){return this.iterate(function(e,r,h,p){var d,f,i,c=[],l=e[0];return l!=="A"&&l!=="a"?null:(l==="a"?(f=h+e[6],i=p+e[7]):(f=e[6],i=e[7]),d=g(h,p,f,i,e[4],e[5],e[1],e[2],e[3]),d.forEach(function(_){c.push(["C",_[2],_[3],_[4],_[5],_[6],_[7]])}),c)}),this},o.prototype.unshort=function(){var e=this.segments,r,h,p,d,f;return this.iterate(function(i,c,l,_){var x=i[0],S=x.toUpperCase(),z;c&&(S==="T"?(z=x==="t",p=e[c-1],p[0]==="Q"?(r=p[1]-l,h=p[2]-_):p[0]==="q"?(r=p[1]-p[3],h=p[2]-p[4]):(r=0,h=0),d=-r,f=-h,z||(d+=l,f+=_),e[c]=[z?"q":"Q",d,f,i[1],i[2]]):S==="S"&&(z=x==="s",p=e[c-1],p[0]==="C"?(r=p[3]-l,h=p[4]-_):p[0]==="c"?(r=p[3]-p[5],h=p[4]-p[6]):(r=0,h=0),d=-r,f=-h,z||(d+=l,f+=_),e[c]=[z?"c":"C",d,f,i[1],i[2],i[3],i[4]]))}),this},o.prototype.reverse=function(){var e=0,r=0,h,p;this.unshort(),this.segments.push(["M",0,0]),this.iterate(function(i,c,l,_){var x=i[0];if(!c&&x.toUpperCase()==="M")return e=i[1],r=i[2],[];switch(x){case"M":e=i[1],r=i[2],i[1]=l,i[2]=_;break;case"L":i[1]=l,i[2]=_;break;case"m":e=l+i[1],r=_+i[2],i[1]=-i[1],i[2]=-i[2];break;case"l":i[1]=-i[1],i[2]=-i[2];break;case"H":i[1]=l;break;case"h":i[1]=-i[1];break;case"V":i[1]=_;break;case"v":i[1]=-i[1];break;case"Z":i[1]=l,i[2]=_;break;case"z":i[1]=l-e,i[2]=_-r;break;case"Q":i[3]=l,i[4]=_;break;case"q":i[1]-=i[3],i[2]-=i[4],i[3]=-i[3],i[4]=-i[4];break;case"C":i[5]=l,i[6]=_,h=i[3],p=i[4],i[3]=i[1],i[4]=i[2],i[1]=h,i[2]=p;break;case"c":h=i[1],p=i[2],i[1]=i[3]-i[5],i[2]=i[4]-i[6],i[3]=h-i[5],i[4]=p-i[6],i[5]=-i[5],i[6]=-i[6];break;case"A":i[6]=l,i[7]=_,i[5]=i[5]?0:1;break;case"a":i[6]=-i[6],i[7]=-i[7],i[5]=i[5]?0:1;break}}),this.segments.reverse();var d=!1,f=!1;return this.iterate(function(i,c,l,_){var x=null;switch(i[0]){case"z":i[0]="l",x=d?[["z"],["l",i[1],i[2]]]:f?null:[["m",0,0],["l",i[1],i[2]]],d=!0;break;case"Z":i[0]="L",x=d?[["Z"],["L",i[1],i[2]]]:f?null:[["m",0,0],["L",i[1],i[2]]],d=!0;break;case"m":x=d?[["z"],["m",i[1],i[2]]]:null,d=!1,f=!0;break;case"M":x=d?[["Z"],["M",i[1],i[2]]]:null,d=!1,f=!0;break;default:f=!1,x=null;break}return x}),d&&this.segments.push(["Z"]),this};function y(e,r){var h=v(e,r);if(e[0]==="z"||e[0]==="Z"||h[0]!==r[0]||h[1]!==r[1])return!1;switch(e[0]){case"c":return e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0;case"C":return e[1]===r[0]&&e[2]===r[1]&&e[3]===r[0]&&e[4]===r[1];case"s":case"q":return e[1]===0&&e[2]===0;case"S":case"Q":return e[1]===r[0]&&e[2]===r[1]}return!0}function b(e,r){return e&&(e[0]==="S"||e[0]==="s"||e[0]==="T"||e[0]==="t")}o.prototype.normalize_first_m=!0,o.prototype.normalize_remove_empty=!0,o.prototype.normalize_smash_m=!0,o.prototype.normalize_smash_z=!0,o.prototype.normalize_a2l=!0,o.prototype.normalize_arc_ellipse=!0,o.prototype.normalize_arc_flags=!1,o.prototype.parseNormalizeFlags=function(e){if(typeof e=="string"){var r;r=e.match(/[Ff]/),r&&(this.normalize_first_m=r[0]==="F"),r=e.match(/[Ee]/),r&&(this.normalize_remove_empty=r[0]==="E"),r=e.match(/[Mm]/),r&&(this.normalize_smash_m=r[0]==="M"),r=e.match(/[Zz]/),r&&(this.normalize_smash_z=r[0]==="Z"),r=e.match(/[Ll]/),r&&(this.normalize_a2l=r[0]==="L"),r=e.match(/[Ee]/),r&&(this.normalize_arc_ellipse=r[0]==="E"),r=e.match(/[Gg]/),r&&(this.normalize_arc_flags=r[0]==="G")}},o.prototype.normalize=function(e){this.parseNormalizeFlags(e);var r=null,h,p,d,f,i=this.segments;return this.iterate(function(c,l,_,x){if(l===0)return this.normalize_first_m&&c[0]==="m"&&(c[0]="M"),r=c,null;if(p=c[0].toLowerCase(),d=r&&r[0].toLowerCase(),h=v(c,[_,x]),this.normalize_remove_empty&&p!=="m"&&y(c,[_,x])){if(!b(i[l+1]))return[];if(p==="c"||p==="s"||p==="q"||p==="t"||p==="a")return p===c[0]?(c[0]="l",c[1]=c[2]=0):(c[0]="L",c[1]=h[0],c[2]=h[1]),c.splice(3),null}if(this.normalize_smash_m&&r&&d==="m"&&p==="m")return r[0]="M",r[1]=h[0],r[2]=h[1],[];if(this.normalize_smash_z&&r&&d==="z"&&p==="z")return[];if(p==="a"){if(f=n(c[1],c[2],c[3],this.precision),this.normalize_a2l&&f.isDegenerate())return c[0]=c[0]===p?"l":"L",c[1]=c[6],c[2]=c[7],c.splice(3),r=c,null;this.normalize_arc_ellipse&&(f.normalise((h[0]-_)/2,(h[1]-x)/2),c[1]=f.rx,c[2]=f.ry,c[3]=f.ax),this.normalize_arc_flags&&(c[4]=c[4]?1:0,c[5]=c[5]?1:0)}return r=c,null}),this},o.prototype.normalize_before_tostring=!0,o.prototype.leading_zeros=0,o.prototype.trailing_zeros=0,o.prototype.coordinate_separator="",o.prototype.zip_space_before_command=!0,o.prototype.zip_space_after_command=!0,o.prototype.zip_space_after_z=!0,o.prototype.zip_space_before_minus=!0,o.prototype.zip_space_before_dot=!1,o.prototype.zip_space_use_e=!1,o.prototype.zip_remove_repeats=!0,o.prototype.zip_remove_l_after_m=!1,o.prototype.parseOutputFormat=function(e){if(typeof e=="string"){var r;r=e.match(/[+-]/),r&&(e+=r[0]==="+"?"BAZMDERL":"bazmderl"),r=e.match(/[Bb]/),r&&(this.zip_space_before_command=r[0]==="B"),r=e.match(/[Aa]/),r&&(this.zip_space_after_command=r[0]==="A"),r=e.match(/[Zz]/),r&&(this.zip_space_after_z=r[0]==="Z"),r=e.match(/[Mm]/),r&&(this.zip_space_before_minus=r[0]==="M"),r=e.match(/[Dd]/),r&&(this.zip_space_before_dot=r[0]==="D"),r=e.match(/[Ee]/),r&&(this.zip_space_use_e=r[0]==="E"),r=e.match(/[Rr]/),r&&(this.zip_remove_repeats=r[0]==="R"),r=e.match(/[Ll]/),r&&(this.zip_remove_l_after_m=r[0]==="L"),r=e.match(/\s?,\s?/),r&&(this.coordinate_separator=r[0]),r=e.match(/(?:0*\.[0X]*|0+)/),r&&(r=r[0].split("."),this.leading_zeros=r[0].length,r.length>1&&(this.precision=Math.min(r[1].length,20),this.trailing_zeros=r[1].split("X")[0].length))}};function M(e,r){for(;e.length<r;)e="0"+e;return e}function k(e,r){for(;e.length<r;)e+="0";return e}return o.prototype.numToString=function(e,r){e=m(e,this.precision);var h=r||this.zip_space_before_minus&&e<0?"":" ",p="";e<0&&(p="-",e=-e);var d=e.toFixed(this.precision).split(".");if(typeof d[1]!="string"&&(d[1]=""),d[1]=d[1].replace(/0*$/,""),d[0]==="0"&&d[1]&&(d[0]=""),this.zip_space_use_e){var f,i;d[1]?d[0]||(i=+d[1]+"e"+-d[1].length,i.length<d[1].length+1&&(d[0]=i,d[1]="")):(i=d[0],f=i.match(/0*$/)[0].length,f>2&&(d[0]=i.slice(0,-f)+"e"+f))}else d[0]=M(d[0],this.leading_zeros),d[1]=k(d[1],this.trailing_zeros);return h+p+d[0]+(d[1]?"."+d[1]:"")},o.prototype.coordsToString=function(e,r,h){return this.numToString(e,h)+this.coordinate_separator+this.numToString(r,this.coordinate_separator)},o.prototype.toString=function(e,r,h){typeof e=="boolean"&&(e=e?"+":"-"),typeof e=="string"&&this.parseOutputFormat(e),h=!!h,typeof r>"u"&&(r=this.normalize_before_tostring),r&&this.normalize(),this.doTransform().round(this.precision);for(var p="",d=!1,f,i=0,c=h&&this.hasErrors()?this.errs[0].segment-1:this.segments.length,l=this.segments[0],_=null;i<c;_=!this.zip_remove_l_after_m||f!=="m"?l[0]:l[0]==="M"?"L":"l",l=this.segments[++i])switch(f=l[0].toLowerCase(),d=!this.zip_remove_repeats||l[0]!==_,d&&(this.zip_space_before_command||(p+=" "),p+=l[0],(!this.zip_space_after_command&&f!=="z"||f==="z"&&!this.zip_space_after_z&&this.zip_space_before_command)&&(p+=" ")),f){case"h":case"v":p+=this.numToString(l[1],d);break;case"a":p+=this.coordsToString(l[1],l[2],d)+this.numToString(l[3])+this.coordsToString(l[4],l[5])+this.coordsToString(l[6],l[7]);break;case"z":break;default:for(var x=1,S=l.length,z=d;x<S;x+=2,z=!1)p+=this.coordsToString(l[x],l[x+1],z);break}return this.zip_space_before_dot&&this.leading_zeros===0?p.trim().replace(/(\.\d+) 0?(?=\.)/g,"$1"):p.trim()},o.prototype.toBox=function(){var e=s();if(this.segments.length===0)return e;var r=this.copy().abs().unarc().unshort().doTransform();return r.iterate(function(h,p,d,f){switch(h[0]){case"H":e.addX(h[1]);break;case"V":e.addY(h[1]);break;case"M":case"L":e.addX(h[1]),e.addY(h[2]);break;case"Q":e.addXQ([d,h[1],h[3]]),e.addYQ([f,h[2],h[4]]);break;case"C":e.addXC([d,h[1],h[3],h[5]]),e.addYC([f,h[2],h[4],h[6]]);break}}),e.minX=m(e.minX,this.precision),e.minY=m(e.minY,this.precision),e.maxX=m(e.maxX,this.precision),e.maxY=m(e.maxY,this.precision),e},o.prototype.toBoxString=function(e){this.parseOutputFormat(e);var r=this.toBox();return[this.numToString(r.minX,!0),this.numToString(r.minY,!0),this.numToString(r.width(),!0),this.numToString(r.height(),!0)].join(" ")},o.prototype.inbox=function(e){return typeof e!="string"&&(e=Array.prototype.join.call(arguments," ")),this.matrix(this.toBox().inboxMatrix(e)),this},K=o,K}var Z,lt;function Ct(){return lt||(lt=1,Z=Lt()),Z}var Et=Ct(),qt=kt(Et);let C=null,pt=null,V=null,mt;const R=Math.cos,B=Math.sin;function Rt(t,u,a,g,n,s){t.beginPath(),t.moveTo(u,a+s),t.arcTo(u,a+n,u+s,a+n,s),t.arcTo(u+g,a+n,u+g,a+n-s,s),t.arcTo(u+g,a,u+g-s,a,s),t.arcTo(u,a,u,a+s,s),t.stroke()}const Bt=(t,u,a)=>{const g=Math.cos,n=Math.sin,s={x:t*-n(a/2),y:t*g(a/2)},o={x:t*n(a/2),y:t*g(a/2)},v={x:u*-n(a/2),y:u*g(a/2)},w={x:u*n(a/2),y:u*g(a/2)},m={x:s.x,y:t},y={x:o.x,y:t},b={x:s.x,y:v.y},M={x:o.x,y:v.y},k=x=>x+Math.abs(s.x),e=x=>t-x,r=x=>({x:k(x.x),y:e(x.y)});console.log("[calculate_points] calc check:",{A:s,B:o,C:v,D:w},{TL:m,TR:y,BL:b,BR:M});const h=r(s),p=r(o),d=r(v),f=r(w),i=r(m),c=r(y),l=r(b),_=r(M);return console.log("[calculate_points] after transform:",{At:h,Bt:p,Ct:d,Dt:f},{TLt:i,TRt:c,BLt:l,BRt:_}),{At:h,Bt:p,Ct:d,Dt:f,TLt:i,TRt:c,BLt:l,BRt:_}},dt=(t,u,a)=>{const g=Bt(t,u,a),n=`M ${g.Bt.x} ${g.Bt.y}`,s=`A ${t} ${t} 0 0 0 ${g.At.x} ${g.At.y}`,o=`L  ${g.Ct.x} ${g.Ct.y}`,v=`A ${u} ${u} 0  0  1  ${g.Dt.x} ${g.Dt.y}`;return[n,s,o,v,"Z"].join(" ")},gt=(t,u,a,g)=>{const n={x:t*-B(g/2),y:t*R(g/2)},s={x:t*B(g/2),y:t*R(g/2)},o={x:u*-B(g/2),y:u*R(g/2)},v={x:u*B(g/2),y:u*R(g/2)},w={x:n.x,y:t},m={x:s.x,y:t},y={x:n.x,y:o.y},b={x:s.x,y:o.y},M=L=>L+Math.abs(n.x),k=L=>t-L,e=L=>({x:M(L.x),y:k(L.y)}),r=e(n),h=e(s),p=e(o),d=e(v),f=e(w),i=e(m),c=e(y),l=e(b);console.log("[SvgExportWidget.WORKER] calc_points2  calc check:",{A:n,B:s,C:o,D:v},{TL:w,TR:m,BL:y,BR:b}),console.log("[SvgExportWidget.WORKER] calc_points2  transform check:",{At:r,Bt:h,Ct:p,Dt:d},{TLt:f,TRt:i,BLt:c,BRt:l});const _=(L,D)=>({x:L.x*D,y:L.y*D}),x=_(r,a),S=_(h,a),z=_(p,a),Y=_(d,a),X=_(f,a),E=_(i,a),T=_(c,a),q=_(l,a);return console.log("[calculate_points] calc_points2  scale check ",{Ats:x,Bts:S,Cts:z,Dts:Y},{TLts:X,TRts:E,BLts:T,BRts:q}),{A:x,B:S,C:z,D:Y,TL:X,TR:E,BL:T,BR:q}},Pt=(t,u,a,g,n,s,o,v,w=!0)=>new Promise((m,y)=>{if(v&&v.aborted)return console.log("[SvgExportWidget.WORKER] generatePreview aborted"),y(null);const b=()=>{console.log("[SvgExportWidget.WORKER] generatePreview.onAbort called"),cancelAnimationFrame(mt),y(null)};if(v&&v.addEventListener("abort",b),t===null)return;const M=Mt(n),k=wt(n),e=k.width+u.left+u.right+a.left+a.right,r=k.height+u.top+u.bottom+a.top+a.bottom,h={width:e,height:r},p=h.width/h.height,d=o.width/o.height,f=p>d?{width:o.width,height:o.width*h.height/h.width}:{height:o.height,width:o.height*h.width/h.height},i=f.width/h.width;console.log("[SvgExportWidget.WORKER] generatePreview started",{printAreaProps:n,printSize:h,totalSize:o,obj_size_scaled:f,scaleFactor:i}),t.canvas.width=Math.round(f.width),t.canvas.height=Math.round(f.height);const c={top:u.top*i,left:u.left*i,right:u.right*i,bottom:u.bottom*i},l={top:a.top*i,left:a.left*i,right:a.right*i,bottom:a.bottom*i},_={width:k.width*i,height:k.height*i},x=_.width+c.left+c.right+l.left+l.right,S=_.height+c.top+c.bottom+l.top+l.bottom;if(console.log("[SvgExportWidget.WORKER] generatePreview totalSizePx",{printSize:h,totalSize:o,totalSizePx:{width:x,height:S}}),console.log("[SvgExportWidget.WORKER] generatePreview drawing data",{offset_px:c,margins_px:l,bounds_px:_}),t.save(),t.fillStyle="rgba(243, 20, 20, 0.5)",t.fillRect(0,0,f.width,f.height),t.fillStyle="rgb(252, 225, 175)",t.clearRect(c.left,c.top,f.width-(c.left+c.right),f.height-(c.top+c.bottom)),t.restore(),t.save(),t.translate(c.left,c.top),t.fillStyle="rgb(255, 255, 255)",t.beginPath(),t.rect(0,0,_.width+l.left+l.right,_.height+l.top+l.bottom),t.fill(),t.setLineDash([5,5]),t.stroke(),t.restore(),M==="ellipse"){t.save(),t.beginPath(),t.translate(c.left,c.top);const Y=(n.horizontal_axis*i+l.left+l.right)/2,X=(n.vertical_axis*i+l.top+l.bottom)/2;t.setLineDash([5,5]),t.ellipse(Y,X,Y,X,0,0,2*Math.PI),t.stroke(),t.restore()}if(M==="circle"){t.save(),t.translate(c.left,c.top),t.beginPath();const Y=n.radius*i+(l.left+l.right)/2;t.setLineDash([5,5]),t.arc(Y,Y,Y,0,2*Math.PI),t.stroke(),t.restore()}if(M==="rect"&&(t.save(),t.translate(c.left,c.top),t.beginPath(),t.rect(0,0,_.width+l.left+l.right,_.height+l.top+l.bottom),t.setLineDash([5,5]),t.stroke(),t.restore()),M==="square"&&(t.save(),t.translate(c.left,c.top),t.beginPath(),t.rect(0,0,_.width+l.left+l.right,_.height+l.top+l.bottom),t.setLineDash([5,5]),t.stroke(),t.restore()),M==="round-corners-2"){t.save(),t.translate(c.left,c.top),t.setLineDash([5,5]);const Y=n.border_radius_tl;Rt(t,0,0,_.width+l.left+l.right,_.height+l.top+l.bottom,Y*i),t.restore()}if(M==="cone"){t.save(),t.translate(c.left+l.left,c.top+l.top);const Y={top_diameter:n.top_radius,height:n.height,bottom_diameter:n.bottom_radius,gap_angle:H(n.gap_angle)};t.strokeStyle="blue";const{R:X,r:E,fi_rad:T,gap_rad:q}=Q(Y),L={R:X*i,r:E*i,fi_rad:T,gap_rad:q},D=dt(L.R,L.r,L.fi_rad-L.gap_rad);let Nt=new Path2D(D);t.setLineDash([5,5]),t.stroke(Nt),t.restore(),t.save(),t.strokeStyle="magenta",t.translate(c.left,c.top);const Ot=gt(X,E,i,T-q),U=X+a.left/Math.tan((T-q)/2),vt=U*E/X,Kt=gt(U,vt,i,T-q);console.log("[SvgExportWidget.WORKER] generatePreview calc_points2",{points:Ot,points2:Kt});const Zt=dt(U*i,vt*i,L.fi_rad-L.gap_rad);t.stroke(new Path2D(Zt)),t.restore()}if(M==="path"){t.save(),t.translate(c.left,c.top);const Y={width:_.width+l.left+l.right,height:_.height+l.top+l.bottom},X=n.path;if(!xt(X)){y(null);return}let E=qt(X).inbox(`0 0 ${Y.width} ${Y.height} meet xMinYMin`).toString(),T=new Path2D(E);t.setLineDash([5,5]),t.strokeStyle="blue",t.lineWidth=2,t.fillStyle="rgba(14, 17, 13, 0.1)",t.fill(T),t.stroke(T),t.restore()}t.drawImage(s,0,0,s.width,s.height,c.left+l.left,c.top+l.top,_.width,_.height),m(null)});self.onmessage=function(t){console.log("[SvgExportWidget.WORKER] onmessage",t.data);const u=t.data;switch(u.type){case"initCanvas":console.log("[SvgExportWidget.WORKER] initCanvas",t.data.type,u.bitmap);const a=u.canvas;a&&(C=a.getContext("2d"),C&&It(a.width,a.height),u.bitmap&&(pt=u.bitmap),postMessage({action:"canvas-init-callback",success:!0}));break;case"startAnimation":_t();break;case"stopAnimation":break;case"drawBitmap":try{V.abort()}catch{}V=new AbortController;const{offset:g,margins:n,units:s,totalSize:o,imageProps:v,printAreaProps:w}=t.data;C!==null&&(console.log("[SvgExportWidget.WORKER] starting execfn with args:",g,n,s,w,o),mt=requestAnimationFrame(()=>Pt(C,g,n,s,w,pt,o,V.signal).then(y=>console.log("[SvgExportWidget.WORKER] generatePreview finished",y)).catch(y=>console.log("[SvgExportWidget.WORKER] generatePreview exception cougth",y))));break}};let P=[];const Dt=1e3,Wt=2;function It(t,u){P=[];for(let a=0;a<Dt;a++)P.push({x:Math.random()*t,y:Math.random()*u,velocityX:(Math.random()-.5)*.5,velocityY:(Math.random()-.5)*.5,color:`hsl(${Math.random()*360}, 80%, 60%)`});console.log("[SvgExportWidget.WORKER] initializeParticles called",{width:t,height:u})}function Ft(t,u){P.forEach(a=>{a.x+=a.velocityX,a.y+=a.velocityY,(a.x<0||a.x>t)&&(a.velocityX*=-1),(a.y<0||a.y>u)&&(a.velocityY*=-1)})}function $t(){if(C===null)return;const t=C.canvas;C.clearRect(0,0,t.width,t.height),P.forEach(u=>{C.beginPath(),C.arc(u.x,u.y,Wt,0,2*Math.PI),C.fillStyle=u.color,C.fill()})}function _t(){if(!C)return;const t=C.canvas;Ft(t.width,t.height),$t(),requestAnimationFrame(_t)}})();
