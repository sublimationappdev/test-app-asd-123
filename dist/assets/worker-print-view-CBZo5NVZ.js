(function(){"use strict";const mt=r=>{const n=r*180/Math.PI;return parseFloat(n.toFixed(1))},Nt=r=>r*Math.PI/180,_t=r=>{const{top_diameter:n,bottom_diameter:h,height:f,gap_angle:a}=r,o=n,s=h,m=f,v=Math.sqrt(Math.pow(o,2)/4+Math.pow(o*m/(o-s),2)),d=Math.sqrt(Math.pow(s,2)/4+Math.pow(s*m/(o-s),2)),b=Math.PI*o/v,y=b*180/Math.PI,M=a/360*y,x=Nt(M);return{R:v,r:d,fi_rad:b,gap_rad:x}},$t=r=>{const{R:n,r:h,fi_rad:f,gap_rad:a}=_t(r),o=f-a,s=n*Math.sin(o/2)*2,m=n-h*Math.cos(o/2);return{width:s,height:m}};function wt(r){return"side"in r}function vt(r){return"width"in r&&"height"in r&&!("border_radius"in r)&&!("border_radius_tl"in r)&&!("path"in r)}function bt(r){return"width"in r&&"height"in r&&"border_radius"in r}function yt(r){return"width"in r&&"height"in r&&("border_radius_tl"in r&&"border_radius_tr"in r&&"border_radius_bl"in r&&"border_radius_br"in r||"border_radius"in r)}function xt(r){return"radius"in r}function Mt(r){return"top_radius"in r&&"bottom_radius"in r}function kt(r){return"vertical_axis"in r&&"horizontal_axis"in r}function zt(r){return"width"in r&&"height"in r&&"path"in r}const Rt=r=>{let n={width:0,height:0};if(wt(r)){const{side:h}=r;({...r},n={width:h,height:h})}if(vt(r)){const{width:h,height:f}=r;n={width:h,height:f},{...r}}if(bt(r)){const{width:h,height:f}=r;n={width:h,height:f},{...r}}if(yt(r)){const{width:h,height:f}=r;n={width:h,height:f},{...r}}if(xt(r)){const{radius:h}=r;n={width:2*h,height:2*h},{...r}}if(Mt(r)){const{top_radius:h,bottom_radius:f,height:a,gap_angle:o}=r,s={top_diameter:h,bottom_diameter:f,height:a,gap_angle:mt(o)};n=$t(s),{...r}}if(kt(r)){const{horizontal_axis:h,vertical_axis:f}=r;n={width:h,height:f},{...r}}if(zt(r)){const{width:h,height:f}=r;n={width:h,height:f},{...r}}return n},Kt=r=>{let n=null;if(n=wt(r)?"square":vt(r)?"rect":bt(r)?"round-corners":yt(r)?"round-corners-2":xt(r)?"circle":Mt(r)?"cone":kt(r)?"ellipse":zt(r)?"path":null,n===null)throw new Error("Invalid printareaprops value");return n};function Zt(r,n,h,f){const a=(m,v)=>{const d=Math.floor(r/m),b=Math.floor(n/v);let y=[];for(let t=0;t<d;t++)for(let e=0;e<b;e++)y.push({x:t*m,y:e*v,rotated:!1});const M=d*m,x=b*v;if(r-M>=v){let t=Math.floor(n/m);for(let e=0;e<t;e++)y.push({x:M,y:e*m,rotated:!0})}if(n-x>=m){let t=Math.floor(r/v);for(let e=0;e<t;e++)y.push({x:e*v,y:x,rotated:!0})}return y},o=a(h,f),s=a(f,h).map(m=>({x:m.x,y:m.y,rotated:!m.rotated}));return o.length>s.length?o:s}function Ut(r){return typeof r!="string"?!1:(r=r.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(r)&&/[\dz]$/i.test(r)&&r.length>4))}function Ht(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ot,Lt;function Qt(){if(Lt)return ot;Lt=1;var r=[];return r[97]=7,r[99]=6,r[104]=1,r[108]=2,r[109]=2,r[113]=4,r[115]=4,r[116]=2,r[118]=1,r[122]=0,ot=function(h){var f=h.length,a,o,s,m,v=0,d=!1,b="",y,M=!1,x=!1,t=[],e=[],c=[];function g(_){c.push({position:a,segment:t.length+1,message:_})}for(a=0;a<=f;a++)if(o=h[a]||"z",s=o.toLowerCase().charCodeAt(0),!(48<=s&&s<=57&&(b+=o,d=!0,e[0]!=="A"&&e[0]!=="a"||s>49||v<3||v>4))){if((s===45||s===43)&&(!d||x&&b[b.length-1]==="e")){b+=o,d=!0;continue}if(s===46&&!M&&!x){b+=o,d=!0,M=!0;continue}if(s===101&&d&&!isNaN(b)){b+="e",d=!0,x=!0;continue}if(d&&(m?(y=+b,isNaN(b)?g("Bad formated number ["+b+"]. I'll ignore it."):(e.push(y),v++)):g("Non expected number ["+b+"] at this place. I'll ignore it."),b="",d=x=M=!1),v===m&&e.length)switch((e[0]==="A"||e[0]==="a")&&(e[4]=e[4]?1:0,e[5]=e[5]?1:0),t.length===0&&e[0]!=="m"&&e[0]!=="M"&&(g("The path must start with M or m. I add 'M 0 0' for you."),t.push(["M",0,0])),t.push(e),v=0,e[0]){case"M":e=["L"];break;case"m":e=["l"];break;case"Z":case"z":e=[];break;default:e=[e[0]]}if(!(s===32||s===9||s===10||s===13||s===44)){if(s===43||s===45||s===46){b=o,M=s===46,d=!0;continue}if(!r.hasOwnProperty(s)){g("Non expected character ["+o+"]. I'll ignore it.");continue}m=r[s],e.length>1&&g("Non complete segment ["+e.join(" ")+"]. I'll ignore it."),e=[o],v=0}}return e.length>1&&g("Non complete segment ["+e.join(" ")+"] (at the end of the path). I'll ignore it."),{errs:c,segments:t}},ot}var st,Tt;function Yt(){if(Tt)return st;Tt=1;function r(h,f){return[h[0]*f[0]+h[2]*f[1],h[1]*f[0]+h[3]*f[1],h[0]*f[2]+h[2]*f[3],h[1]*f[2]+h[3]*f[3],h[0]*f[4]+h[2]*f[5]+h[4],h[1]*f[4]+h[3]*f[5]+h[5]]}function n(h){if(!(this instanceof n))return new n(h);if(!h)h=[];else switch(h.constructor){case String:h=h.trim().split(/\s+/).map(parseFloat);break;case n:h=h.toArray();break;case Array:break;default:h=[]}this.matrix=h.slice().concat([1,0,0,1,0,0].slice(h.length))}return n.prototype.copy=function(h){return new n(this.matrix)},n.prototype.isIdentity=function(h){return h?(this.matrix[0]-1)*(this.matrix[0]-1)+this.matrix[1]*this.matrix[1]+this.matrix[2]*this.matrix[2]+(this.matrix[3]-1)*(this.matrix[3]-1)+this.matrix[4]*this.matrix[4]+this.matrix[5]*this.matrix[5]<h:this.matrix[0]===1&&this.matrix[1]===0&&this.matrix[2]===0&&this.matrix[3]===1&&this.matrix[4]===0&&this.matrix[5]===0},n.prototype.preserveH=function(){return!this.matrix[1]},n.prototype.preserveV=function(){return!this.matrix[2]},n.prototype.det=function(){return this.matrix[0]*this.matrix[3]-this.matrix[1]*this.matrix[2]},n.prototype.reset=function(){return this.matrix=[1,0,0,1,0,0],this},n.prototype.compose=function(h){return(!h||h.constructor!==n)&&(h=new n(h)),h.isIdentity()?this:(this.matrix=r(h.matrix,this.matrix),this)},n.prototype.translate=function(h,f){return this.matrix[4]+=h,this.matrix[5]+=f,this},n.prototype.scale=function(h,f){return(h!==1||f!==1)&&(this.matrix[0]*=h,this.matrix[2]*=h,this.matrix[4]*=h,this.matrix[1]*=f,this.matrix[3]*=f,this.matrix[5]*=f),this},n.prototype.rotate=function(h,f,a){var o,s,m;return h!==0&&(o=h*Math.PI/180,s=Math.cos(o),m=Math.sin(o),this.translate(-f,-a).compose([s,m,-m,s,0,0]).translate(f,a)),this},n.prototype.skewX=function(h){return h!==0&&this.compose([1,0,Math.tan(h*Math.PI/180),1,0,0]),this},n.prototype.skewY=function(h){return h!==0&&this.compose([1,Math.tan(h*Math.PI/180),0,1,0,0]),this},n.prototype.toArray=function(){return this.matrix},n.prototype.calc=function(h,f,a){return[this.matrix[0]*h+this.matrix[2]*f+(a?0:this.matrix[4]),this.matrix[1]*h+this.matrix[3]*f+(a?0:this.matrix[5])]},st=n,st}var ht,Ct;function Gt(){if(Ct)return ht;Ct=1;var r=Yt(),n={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},h=/\s*((?:matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(?:.+?)\s*\))[\s,]*/,f=/[\s(),]+/;return ht=function(o){var s=r(),m,v,d;m=o.split(h).filter(Boolean);for(var b=m.length-1;b>=0;b--)if(d=m[b].split(f).filter(Boolean),!(d.length<2))switch(v=d.shift(),n[v]&&(d=d.map(parseFloat)),v){case"matrix":(d.length===6||d.length===4)&&s.compose(d);break;case"scale":d.length===1?s.scale(d[0],d[0]):d.length===2&&s.scale(d[0],d[1]);break;case"rotate":d.length===1?s.rotate(d[0],0,0):d.length===3&&s.rotate(d[0],d[1],d[2]);break;case"translate":d.length===1?s.translate(d[0],0):d.length===2&&s.translate(d[0],d[1]);break;case"skewX":d.length===1&&s.skewX(d[0]);break;case"skewY":d.length===1&&s.skewY(d[0]);break}return s},ht}var ct,Xt;function Jt(){if(Xt)return ct;Xt=1;var r=Math.PI*2;function n(a,o,s,m){var v=a*m-o*s<0?-1:1,d=a*s+o*m;return d>1&&(d=1),d<-1&&(d=-1),v*Math.acos(d)}function h(a,o,s,m,v,d,b,y,M,x){var t=x*(a-s)/2+M*(o-m)/2,e=-M*(a-s)/2+x*(o-m)/2,c=b*b,g=y*y,_=t*t,u=e*e,i=c*g-c*u-g*_;i<0&&(i=0),i/=c*u+g*_,i=Math.sqrt(i)*(v===d?-1:1);var l=i*b/y*e,p=i*-y/b*t,w=x*l-M*p+(a+s)/2,k=M*l+x*p+(o+m)/2,R=(t-l)/b,L=(e-p)/y,Y=(-t-l)/b,T=(-e-p)/y,B=n(1,0,R,L),q=n(R,L,Y,T);return d===0&&q>0&&(q-=r),d===1&&q<0&&(q+=r),[w,k,B,q]}function f(a,o){var s=1.3333333333333333*Math.tan(o/4),m=Math.cos(a),v=Math.sin(a),d=Math.cos(a+o),b=Math.sin(a+o);return[m,v,m-v*s,v+m*s,d+b*s,b-d*s,d,b]}return ct=function(o,s,m,v,d,b,y,M,x){var t=Math.sin(x*r/360),e=Math.cos(x*r/360),c=e*(o-m)/2+t*(s-v)/2,g=-t*(o-m)/2+e*(s-v)/2;if(c===0&&g===0)return[];if(y===0||M===0)return[];y=Math.abs(y),M=Math.abs(M);var _=c*c/(y*y)+g*g/(M*M);_>1&&(y*=Math.sqrt(_),M*=Math.sqrt(_));var u=h(o,s,m,v,d,b,y,M,t,e),i=[],l=u[2],p=u[3],w=Math.max(Math.ceil(Math.abs(p)/(r/4)),1);p/=w;for(var k=0;k<w;k++)i.push(f(l,p)),l+=p;return i.map(function(R){for(var L=0;L<R.length;L+=2){var Y=R[L+0],T=R[L+1];Y*=y,T*=M;var B=e*Y-t*T,q=t*Y+e*T;R[L+0]=B+u[0],R[L+1]=q+u[1]}return R})},ct}var lt,St;function jt(){if(St)return lt;St=1;var r=Math.PI/180;function n(h,f,a,o){if(!(this instanceof n))return new n(h,f,a,o);this.rx=h,this.ry=f,this.ax=a,this.epsilon=typeof o>"u"?1e-7:+("1e"+-o)}return n.prototype.transform=function(h){var f=Math.cos(this.ax*r),a=Math.sin(this.ax*r),o=[this.rx*(h[0]*f+h[2]*a),this.rx*(h[1]*f+h[3]*a),this.ry*(-h[0]*a+h[2]*f),this.ry*(-h[1]*a+h[3]*f)],s=o[0]*o[0]+o[2]*o[2],m=o[1]*o[1]+o[3]*o[3],v=Math.sqrt(((o[0]-o[3])*(o[0]-o[3])+(o[2]+o[1])*(o[2]+o[1]))*((o[0]+o[3])*(o[0]+o[3])+(o[2]-o[1])*(o[2]-o[1]))),d=(s+m)/2;if(v<=this.epsilon)return this.rx=this.ry=Math.sqrt(d),this.ax=0,this;if(Math.abs(v-Math.abs(s-m))<=this.epsilon)return this.rx=Math.sqrt(s),this.ry=Math.sqrt(m),this.ax=0,this;var b=o[0]*o[1]+o[2]*o[3],y=d+v/2,M=d-v/2;return Math.abs(b)<=this.epsilon&&Math.abs(y-m)<=this.epsilon?(this.ax=0,this.rx=Math.sqrt(M),this.ry=Math.sqrt(y),this):(this.ax=Math.atan(Math.abs(b)>Math.abs(y-m)?(y-s)/b:b/(y-m))/r,this.ax>=0?(this.rx=Math.sqrt(y),this.ry=Math.sqrt(M)):(this.ax+=90,this.rx=Math.sqrt(M),this.ry=Math.sqrt(y)),this)},n.prototype.isDegenerate=function(){return Math.abs(this.rx)<=this.epsilon||Math.abs(this.ry)<=this.epsilon},n.prototype.normalise=function(h,f){if(this.rx=Math.abs(this.rx),this.ry=Math.abs(this.ry),Math.abs(this.rx-this.ry)<=this.epsilon)this.ax=0,this.rx=this.ry=(this.rx+this.ry)/2;else if(this.ax=this.ax%180,this.ax<0&&(this.ax+=180),this.ax>=90){var a;a=this.rx,this.rx=this.ry,this.ry=a,this.ax=this.ax-90}if(!h&&!f)return this;var o=Math.cos(this.ax*r),s=Math.sin(-this.ax*r),m=(h*o-f*s)/this.rx,v=(h*s+f*o)/this.ry,d=Math.sqrt(m*m+v*v);return d>1&&(this.rx*=d,this.ry*=d),this},lt=n,lt}var ft,Pt;function At(){if(Pt)return ft;Pt=1;function r(a){if(!(this instanceof r))return new r(a);if(a&&a.constructor===String){var o=a.trim().split(/\s+/).map(parseFloat);this.addX(o[0]).addX(o[0]+o[2]).addY(o[1]).addY(o[1]+o[3])}return this}r.prototype.copy=function(){var a=new r;return a.minX=this.minX,a.minY=this.minY,a.maxX=this.maxX,a.maxY=this.maxY,a},r.prototype.width=function(){return typeof this.minX>"u"?0:this.maxX-this.minX},r.prototype.height=function(){return typeof this.minY>"u"?0:this.maxY-this.minY},r.prototype.isUndefined=function(){return typeof this.minX>"u"||typeof this.minY>"u"},r.prototype.addX=function(a){return typeof this.minX>"u"?this.minX=this.maxX=a:(this.minX=Math.min(this.minX,a),this.maxX=Math.max(this.maxX,a)),this},r.prototype.addY=function(a){return typeof this.minY>"u"?this.minY=this.maxY=a:(this.minY=Math.min(this.minY,a),this.maxY=Math.max(this.maxY,a)),this},r.prototype.addPoint=function(a,o){return this.addX(a).addY(o)};function n(a){var o=Math.min(a[0],a[2]),s=Math.max(a[0],a[2]);if(a[1]>a[0]?a[2]>=a[1]:a[2]<=a[1])return[o,s];var m=(a[0]*a[2]-a[1]*a[1])/(a[0]-2*a[1]+a[2]);return m<o?[m,s]:[o,m]}r.prototype.addXQ=function(a){var o=n(a);return this.addX(o[0]).addX(o[1])},r.prototype.addYQ=function(a){var o=n(a);return this.addY(o[0]).addY(o[1])};var h=1e-8;function f(a){var o=a[0]-3*a[1]+3*a[2]-a[3];if(Math.abs(o)<h)return n([a[0],-.5*a[0]+1.5*a[1],a[0]-3*a[1]+3*a[2]]);var s=-a[0]*a[2]+a[0]*a[3]-a[1]*a[2]-a[1]*a[3]+a[1]*a[1]+a[2]*a[2];if(s<=0)return[Math.min(a[0],a[3]),Math.max(a[0],a[3])];for(var m=Math.sqrt(s),v=Math.max(a[0],a[3]),d=Math.min(a[0],a[3]),b=a[0]-2*a[1]+a[2],y=(b+m)/o,M=1;M<=2;y=(b-m)/o,M++)if(y>0&&y<1){var x=a[0]*(1-y)*(1-y)*(1-y)+a[1]*3*(1-y)*(1-y)*y+a[2]*3*(1-y)*y*y+a[3]*y*y*y;x<d&&(d=x),x>v&&(v=x)}return[d,v]}return r.prototype.addXC=function(a){var o=f(a);return this.addX(o[0]).addX(o[1])},r.prototype.addYC=function(a){var o=f(a);return this.addY(o[0]).addY(o[1])},r.prototype.toArray=function(){return this.isUndefined()?[0,0,0,0]:[this.minX,this.minY,this.maxX,this.maxY]},r.prototype.toString=function(a){return this.isUndefined()?"0 0 0 0":(typeof a>"u"?[this.minX,this.minY,this.width(),this.height()]:[this.minX.toFixed(a),this.minY.toFixed(a),this.width().toFixed(a),this.height().toFixed(a)]).join(" ")},r.prototype.inboxMatrix=function(a){var o=new r(a.match(/(-|\d|\.|\s)+/)[0]),s=(a+"meet").match(/(fit|none|meet|slice|move)/)[0];s==="none"&&(s="fit");var m,v;switch(s){case"fit":m=this.width()?o.width()/this.width():1,v=this.height()?o.height()/this.height():1;break;case"slice":if(this.width()!==0&&this.height()!==0){m=v=Math.max(o.width()/this.width(),o.height()/this.height());break}case"meet":m=v=this.width()===0&&this.height()===0?1:Math.min(o.width()/this.width(),o.height()/this.height());break;case"move":m=v=1;break}var d={};d.X=(a+"xMid").match(/x(Min|Mid|Max)/i)[1].toLowerCase(),d.Y=(a+"YMid").match(/Y(Min|Mid|Max)/i)[1].toLowerCase();var b={},y={};y.src=this,y.dst=o;for(var M="X",x=1;x<=2;M="Y",x++)for(var t="src",e=1;e<=2;t="dst",e++)switch(d[M]){case"min":b[t+M]=y[t]["min"+M];break;case"mid":b[t+M]=(y[t]["min"+M]+y[t]["max"+M])/2;break;case"max":b[t+M]=y[t]["max"+M];break}return[m,0,0,v,b.dstX-m*b.srcX,b.dstY-v*b.srcY]},ft=r,ft}var ut,qt;function te(){if(qt)return ut;qt=1;var r=Qt(),n=Gt(),h=Yt(),f=Jt(),a=jt(),o=At();function s(t){if(!(this instanceof s))return new s(t);var e=r(t);this.segments=e.segments,this.errs=e.errs,this.affineTransform=h()}s.prototype.precision=7,s.prototype.copy=function(){for(var t=new s(""),e=0,c=this.segments.length;e<c;e++)t.segments[e]=this.segments[e].slice(0);return t.errs=this.errs,t.affineTransform=this.affineTransform.copy(),t},s.prototype.hasErrors=function(){return this.errs.length>0},s.prototype.errors=function(){var t=[],e=this.errs.length,c;for(c=0;c<e;c++)t.push("[pos:"+this.errs[c].position+", seg:"+this.errs[c].segment+"] "+this.errs[c].message);return t.join(`
`)},s.prototype.toArray=function(t){return t=!!t,this.doTransform().round(this.precision),t&&this.hasErrors()?this.segments.concat.apply([],this.segments.slice(0,this.errs[0].segment-1)):this.segments.concat.apply([],this.segments)};function m(t,e){if(t.length<=1)return null;var c=[0,0],g;switch(t[0]){case"h":case"H":c[0]=t[1],c[1]=t[0]==="h"?0:e[1];break;case"v":case"V":c[0]=t[0]==="v"?0:e[0],c[1]=t[1];break;default:g=t.length-2,c[0]=t[g],c[1]=t[g+1]}return t[0]===t[0].toLowerCase()&&(c[0]+=e[0],c[1]+=e[1]),c}s.prototype.iterate=function(t){var e=this,c=this.segments,g=[],_=[],u=[0,0],i=[0,0];if(c.forEach(function(w,k){var R=u[0],L=u[1],Y;w[0]==="z"||w[0]==="Z"?u=i.slice():(u=m(w,u),(w[0]==="m"||w[0]==="M")&&(i=u.slice())),Y=t.call(e,w,k,R,L),Array.isArray(Y)&&(g[k]=Y)}),g.length===0)return this;for(var l=0,p=c.length;l<p;l++)typeof g[l]<"u"?_.push.apply(_,g[l]):_.push(c[l]);return this.segments=_,this};function v(t,e){t.iterate(function(c,g,_,u){var i,l,p,w;switch(c[0]){case"v":i=e.calc(0,c[1],!0),l=e.preserveV()?["v",i[1]]:["l",i[0],i[1]];break;case"V":i=e.calc(_,c[1],!1),l=e.preserveV()?["V",i[1]]:["L",i[0],i[1]];break;case"h":i=e.calc(c[1],0,!0),l=e.preserveH()?["h",i[0]]:["l",i[0],i[1]];break;case"H":i=e.calc(c[1],u,!1),l=e.preserveH()?["H",i[0]]:["L",i[0],i[1]];break;case"a":case"A":var k=a(c[1],c[2],c[3],this.precision).transform(e.toArray());i=e.calc(c[6],c[7],c[0]==="a"),k.isDegenerate()?l=[c[0]==="a"?"l":"L",i[0],i[1]]:(e.det()<0&&(c[5]=c[5]?0:1),l=[c[0],k.rx,k.ry,k.ax,c[4],c[5],i[0],i[1]]);break;default:p=c[0],l=[p],w=p.toLowerCase()===p&&g;for(var R=1,L=c.length;R<L;R+=2)i=e.calc(c[R],c[R+1],w),l.push(i[0],i[1])}return[l]})}s.prototype.doTransform=function(){return this.affineTransform.isIdentity()?this:(v(this,this.affineTransform),this.affineTransform.reset(),this)},s.prototype.translate=function(t,e){return this.affineTransform.translate(t,e||0),this},s.prototype.scale=function(t,e){return this.affineTransform.scale(t,isNaN(e)?t:e),this},s.prototype.rotate=function(t,e,c){return this.affineTransform.rotate(t,e||0,c||0),this},s.prototype.skewX=function(t){return this.affineTransform.skewX(t),this},s.prototype.skewY=function(t){return this.affineTransform.skewY(t),this},s.prototype.matrix=function(t){return this.affineTransform.compose(t),this},s.prototype.transform=function(t){return t.trim()?(this.affineTransform.compose(n(t)),this):this};function d(t,e){return e=~~e,e===0?Math.round(t):(t=+t,isNaN(t)?NaN:(t=t.toString().split("e"),t=Math.round(+t[0]+"e"+(~~t[1]+e)),t=t.toString().split("e"),+(t[0]+"e"+(~~t[1]-e))))}s.prototype.round=function(t){this.precision=t=~~t;var e=0,c=0,g=0,_=0;return this.doTransform(),this.segments.forEach(function(u){var i=u[0].toLowerCase()===u[0],l,p,w;switch(u[0]){case"H":case"h":i&&(u[1]+=g),l=u[1],u[1]=d(l,t),g=l-u[1];return;case"V":case"v":i&&(u[1]+=_),p=u[1],u[1]=d(p,t),_=p-u[1];return;case"Z":case"z":g=e,_=c;return;case"A":case"a":u[1]=d(u[1],t),u[2]=d(u[2],t),u[3]=d(u[3],t+2),i&&(u[6]+=g,u[7]+=_),l=u[6],p=u[7],u[6]=d(l,t),u[7]=d(p,t),g=l-u[6],_=p-u[7];return;default:for(w=u.length-3,i&&(u[w+1]+=g,u[w+2]+=_),l=u[w+1],p=u[w+2],u[w+1]=d(l,t),u[w+2]=d(p,t),g=l-u[w+1],_=p-u[w+2];w>0;w--)u[w]=d(u[w],t);u[0].toLowerCase()==="m"&&(e=g,c=_);return}}),this},s.prototype.abs=function(){return this.iterate(function(t,e,c,g){var _=t[0],u=_.toUpperCase();if(_!==u)switch(t[0]=u,_){case"v":t[1]+=g;return;case"a":t[6]+=c,t[7]+=g;return;default:for(var i=1,l=t.length;i<l;i++)t[i]+=i%2?c:g}}),this},s.prototype.rel=function(){return this.iterate(function(t,e,c,g){var _=t[0],u=_.toLowerCase();if(_!==u&&!(e===0&&_==="M"))switch(t[0]=u,_){case"V":t[1]-=g;return;case"A":t[6]-=c,t[7]-=g;return;default:for(var i=1,l=t.length;i<l;i++)t[i]-=i%2?c:g}}),this},s.prototype.unarc=function(){return this.iterate(function(t,e,c,g){var _,u,i,l=[],p=t[0];return p!=="A"&&p!=="a"?null:(p==="a"?(u=c+t[6],i=g+t[7]):(u=t[6],i=t[7]),_=f(c,g,u,i,t[4],t[5],t[1],t[2],t[3]),_.forEach(function(w){l.push(["C",w[2],w[3],w[4],w[5],w[6],w[7]])}),l)}),this},s.prototype.unshort=function(){var t=this.segments,e,c,g,_,u;return this.iterate(function(i,l,p,w){var k=i[0],R=k.toUpperCase(),L;l&&(R==="T"?(L=k==="t",g=t[l-1],g[0]==="Q"?(e=g[1]-p,c=g[2]-w):g[0]==="q"?(e=g[1]-g[3],c=g[2]-g[4]):(e=0,c=0),_=-e,u=-c,L||(_+=p,u+=w),t[l]=[L?"q":"Q",_,u,i[1],i[2]]):R==="S"&&(L=k==="s",g=t[l-1],g[0]==="C"?(e=g[3]-p,c=g[4]-w):g[0]==="c"?(e=g[3]-g[5],c=g[4]-g[6]):(e=0,c=0),_=-e,u=-c,L||(_+=p,u+=w),t[l]=[L?"c":"C",_,u,i[1],i[2],i[3],i[4]]))}),this},s.prototype.reverse=function(){var t=0,e=0,c,g;this.unshort(),this.segments.push(["M",0,0]),this.iterate(function(i,l,p,w){var k=i[0];if(!l&&k.toUpperCase()==="M")return t=i[1],e=i[2],[];switch(k){case"M":t=i[1],e=i[2],i[1]=p,i[2]=w;break;case"L":i[1]=p,i[2]=w;break;case"m":t=p+i[1],e=w+i[2],i[1]=-i[1],i[2]=-i[2];break;case"l":i[1]=-i[1],i[2]=-i[2];break;case"H":i[1]=p;break;case"h":i[1]=-i[1];break;case"V":i[1]=w;break;case"v":i[1]=-i[1];break;case"Z":i[1]=p,i[2]=w;break;case"z":i[1]=p-t,i[2]=w-e;break;case"Q":i[3]=p,i[4]=w;break;case"q":i[1]-=i[3],i[2]-=i[4],i[3]=-i[3],i[4]=-i[4];break;case"C":i[5]=p,i[6]=w,c=i[3],g=i[4],i[3]=i[1],i[4]=i[2],i[1]=c,i[2]=g;break;case"c":c=i[1],g=i[2],i[1]=i[3]-i[5],i[2]=i[4]-i[6],i[3]=c-i[5],i[4]=g-i[6],i[5]=-i[5],i[6]=-i[6];break;case"A":i[6]=p,i[7]=w,i[5]=i[5]?0:1;break;case"a":i[6]=-i[6],i[7]=-i[7],i[5]=i[5]?0:1;break}}),this.segments.reverse();var _=!1,u=!1;return this.iterate(function(i,l,p,w){var k=null;switch(i[0]){case"z":i[0]="l",k=_?[["z"],["l",i[1],i[2]]]:u?null:[["m",0,0],["l",i[1],i[2]]],_=!0;break;case"Z":i[0]="L",k=_?[["Z"],["L",i[1],i[2]]]:u?null:[["m",0,0],["L",i[1],i[2]]],_=!0;break;case"m":k=_?[["z"],["m",i[1],i[2]]]:null,_=!1,u=!0;break;case"M":k=_?[["Z"],["M",i[1],i[2]]]:null,_=!1,u=!0;break;default:u=!1,k=null;break}return k}),_&&this.segments.push(["Z"]),this};function b(t,e){var c=m(t,e);if(t[0]==="z"||t[0]==="Z"||c[0]!==e[0]||c[1]!==e[1])return!1;switch(t[0]){case"c":return t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0;case"C":return t[1]===e[0]&&t[2]===e[1]&&t[3]===e[0]&&t[4]===e[1];case"s":case"q":return t[1]===0&&t[2]===0;case"S":case"Q":return t[1]===e[0]&&t[2]===e[1]}return!0}function y(t,e){return t&&(t[0]==="S"||t[0]==="s"||t[0]==="T"||t[0]==="t")}s.prototype.normalize_first_m=!0,s.prototype.normalize_remove_empty=!0,s.prototype.normalize_smash_m=!0,s.prototype.normalize_smash_z=!0,s.prototype.normalize_a2l=!0,s.prototype.normalize_arc_ellipse=!0,s.prototype.normalize_arc_flags=!1,s.prototype.parseNormalizeFlags=function(t){if(typeof t=="string"){var e;e=t.match(/[Ff]/),e&&(this.normalize_first_m=e[0]==="F"),e=t.match(/[Ee]/),e&&(this.normalize_remove_empty=e[0]==="E"),e=t.match(/[Mm]/),e&&(this.normalize_smash_m=e[0]==="M"),e=t.match(/[Zz]/),e&&(this.normalize_smash_z=e[0]==="Z"),e=t.match(/[Ll]/),e&&(this.normalize_a2l=e[0]==="L"),e=t.match(/[Ee]/),e&&(this.normalize_arc_ellipse=e[0]==="E"),e=t.match(/[Gg]/),e&&(this.normalize_arc_flags=e[0]==="G")}},s.prototype.normalize=function(t){this.parseNormalizeFlags(t);var e=null,c,g,_,u,i=this.segments;return this.iterate(function(l,p,w,k){if(p===0)return this.normalize_first_m&&l[0]==="m"&&(l[0]="M"),e=l,null;if(g=l[0].toLowerCase(),_=e&&e[0].toLowerCase(),c=m(l,[w,k]),this.normalize_remove_empty&&g!=="m"&&b(l,[w,k])){if(!y(i[p+1]))return[];if(g==="c"||g==="s"||g==="q"||g==="t"||g==="a")return g===l[0]?(l[0]="l",l[1]=l[2]=0):(l[0]="L",l[1]=c[0],l[2]=c[1]),l.splice(3),null}if(this.normalize_smash_m&&e&&_==="m"&&g==="m")return e[0]="M",e[1]=c[0],e[2]=c[1],[];if(this.normalize_smash_z&&e&&_==="z"&&g==="z")return[];if(g==="a"){if(u=a(l[1],l[2],l[3],this.precision),this.normalize_a2l&&u.isDegenerate())return l[0]=l[0]===g?"l":"L",l[1]=l[6],l[2]=l[7],l.splice(3),e=l,null;this.normalize_arc_ellipse&&(u.normalise((c[0]-w)/2,(c[1]-k)/2),l[1]=u.rx,l[2]=u.ry,l[3]=u.ax),this.normalize_arc_flags&&(l[4]=l[4]?1:0,l[5]=l[5]?1:0)}return e=l,null}),this},s.prototype.normalize_before_tostring=!0,s.prototype.leading_zeros=0,s.prototype.trailing_zeros=0,s.prototype.coordinate_separator="",s.prototype.zip_space_before_command=!0,s.prototype.zip_space_after_command=!0,s.prototype.zip_space_after_z=!0,s.prototype.zip_space_before_minus=!0,s.prototype.zip_space_before_dot=!1,s.prototype.zip_space_use_e=!1,s.prototype.zip_remove_repeats=!0,s.prototype.zip_remove_l_after_m=!1,s.prototype.parseOutputFormat=function(t){if(typeof t=="string"){var e;e=t.match(/[+-]/),e&&(t+=e[0]==="+"?"BAZMDERL":"bazmderl"),e=t.match(/[Bb]/),e&&(this.zip_space_before_command=e[0]==="B"),e=t.match(/[Aa]/),e&&(this.zip_space_after_command=e[0]==="A"),e=t.match(/[Zz]/),e&&(this.zip_space_after_z=e[0]==="Z"),e=t.match(/[Mm]/),e&&(this.zip_space_before_minus=e[0]==="M"),e=t.match(/[Dd]/),e&&(this.zip_space_before_dot=e[0]==="D"),e=t.match(/[Ee]/),e&&(this.zip_space_use_e=e[0]==="E"),e=t.match(/[Rr]/),e&&(this.zip_remove_repeats=e[0]==="R"),e=t.match(/[Ll]/),e&&(this.zip_remove_l_after_m=e[0]==="L"),e=t.match(/\s?,\s?/),e&&(this.coordinate_separator=e[0]),e=t.match(/(?:0*\.[0X]*|0+)/),e&&(e=e[0].split("."),this.leading_zeros=e[0].length,e.length>1&&(this.precision=Math.min(e[1].length,20),this.trailing_zeros=e[1].split("X")[0].length))}};function M(t,e){for(;t.length<e;)t="0"+t;return t}function x(t,e){for(;t.length<e;)t+="0";return t}return s.prototype.numToString=function(t,e){t=d(t,this.precision);var c=e||this.zip_space_before_minus&&t<0?"":" ",g="";t<0&&(g="-",t=-t);var _=t.toFixed(this.precision).split(".");if(typeof _[1]!="string"&&(_[1]=""),_[1]=_[1].replace(/0*$/,""),_[0]==="0"&&_[1]&&(_[0]=""),this.zip_space_use_e){var u,i;_[1]?_[0]||(i=+_[1]+"e"+-_[1].length,i.length<_[1].length+1&&(_[0]=i,_[1]="")):(i=_[0],u=i.match(/0*$/)[0].length,u>2&&(_[0]=i.slice(0,-u)+"e"+u))}else _[0]=M(_[0],this.leading_zeros),_[1]=x(_[1],this.trailing_zeros);return c+g+_[0]+(_[1]?"."+_[1]:"")},s.prototype.coordsToString=function(t,e,c){return this.numToString(t,c)+this.coordinate_separator+this.numToString(e,this.coordinate_separator)},s.prototype.toString=function(t,e,c){typeof t=="boolean"&&(t=t?"+":"-"),typeof t=="string"&&this.parseOutputFormat(t),c=!!c,typeof e>"u"&&(e=this.normalize_before_tostring),e&&this.normalize(),this.doTransform().round(this.precision);for(var g="",_=!1,u,i=0,l=c&&this.hasErrors()?this.errs[0].segment-1:this.segments.length,p=this.segments[0],w=null;i<l;w=!this.zip_remove_l_after_m||u!=="m"?p[0]:p[0]==="M"?"L":"l",p=this.segments[++i])switch(u=p[0].toLowerCase(),_=!this.zip_remove_repeats||p[0]!==w,_&&(this.zip_space_before_command||(g+=" "),g+=p[0],(!this.zip_space_after_command&&u!=="z"||u==="z"&&!this.zip_space_after_z&&this.zip_space_before_command)&&(g+=" ")),u){case"h":case"v":g+=this.numToString(p[1],_);break;case"a":g+=this.coordsToString(p[1],p[2],_)+this.numToString(p[3])+this.coordsToString(p[4],p[5])+this.coordsToString(p[6],p[7]);break;case"z":break;default:for(var k=1,R=p.length,L=_;k<R;k+=2,L=!1)g+=this.coordsToString(p[k],p[k+1],L);break}return this.zip_space_before_dot&&this.leading_zeros===0?g.trim().replace(/(\.\d+) 0?(?=\.)/g,"$1"):g.trim()},s.prototype.toBox=function(){var t=o();if(this.segments.length===0)return t;var e=this.copy().abs().unarc().unshort().doTransform();return e.iterate(function(c,g,_,u){switch(c[0]){case"H":t.addX(c[1]);break;case"V":t.addY(c[1]);break;case"M":case"L":t.addX(c[1]),t.addY(c[2]);break;case"Q":t.addXQ([_,c[1],c[3]]),t.addYQ([u,c[2],c[4]]);break;case"C":t.addXC([_,c[1],c[3],c[5]]),t.addYC([u,c[2],c[4],c[6]]);break}}),t.minX=d(t.minX,this.precision),t.minY=d(t.minY,this.precision),t.maxX=d(t.maxX,this.precision),t.maxY=d(t.maxY,this.precision),t},s.prototype.toBoxString=function(t){this.parseOutputFormat(t);var e=this.toBox();return[this.numToString(e.minX,!0),this.numToString(e.minY,!0),this.numToString(e.width(),!0),this.numToString(e.height(),!0)].join(" ")},s.prototype.inbox=function(t){return typeof t!="string"&&(t=Array.prototype.join.call(arguments," ")),this.matrix(this.toBox().inboxMatrix(t)),this},ut=s,ut}var pt,Et;function ee(){return Et||(Et=1,pt=te()),pt}var ie=ee(),re=Ht(ie);function ae(r,n,h="xMid",f="YMid"){if(n.width<=0||n.height<=0)return{x:r.x,y:r.y,width:0,height:0,scale:0};if(r.width<=0||r.height<=0)return{x:r.x,y:r.y,width:0,height:0,scale:0};const a=r.width/r.height,o=n.width/n.height;let s,m,v;o>a?(s=r.width/n.width,m=r.width,v=n.height*s):(s=r.height/n.height,m=n.width*s,v=r.height);let d,b;switch(h){case"xMin":d=r.x;break;case"xMax":d=r.x+r.width-m;break;default:d=r.x+(r.width-m)/2;break}switch(f){case"YMin":b=r.y;break;case"YMax":b=r.y+r.height-v;break;default:b=r.y+(r.height-v)/2;break}return{x:Math.round(d*1e3)/1e3,y:Math.round(b*1e3)/1e3,width:Math.round(m*1e3)/1e3,height:Math.round(v*1e3)/1e3,scale:Math.round(s*1e3)/1e3}}let z=null,Q=null,G=null,dt=null,Wt;const A=Math.cos,tt=Math.sin;let J={};function ne(r,n,h,f,a,o){r.beginPath(),r.moveTo(n,h+o),r.arcTo(n,h+a,n+o,h+a,o),r.arcTo(n+f,h+a,n+f,h+a-o,o),r.arcTo(n+f,h,n+f-o,h,o),r.arcTo(n,h,n,h+o,o),r.stroke()}const oe=(r,n,h)=>{const f=Math.cos,a=Math.sin,o={x:r*-a(h/2),y:r*f(h/2)},s={x:r*a(h/2),y:r*f(h/2)},m={x:n*-a(h/2),y:n*f(h/2)},v={x:n*a(h/2),y:n*f(h/2)},d={x:o.x,y:r},b={x:s.x,y:r},y={x:o.x,y:m.y},M={x:s.x,y:m.y},x=k=>k+Math.abs(o.x),t=k=>r-k,e=k=>({x:x(k.x),y:t(k.y)});console.log("[calculate_points] calc check:",{A:o,B:s,C:m,D:v},{TL:d,TR:b,BL:y,BR:M});const c=e(o),g=e(s),_=e(m),u=e(v),i=e(d),l=e(b),p=e(y),w=e(M);return console.log("[calculate_points] after transform:",{At:c,Bt:g,Ct:_,Dt:u},{TLt:i,TRt:l,BLt:p,BRt:w}),{At:c,Bt:g,Ct:_,Dt:u,TLt:i,TRt:l,BLt:p,BRt:w}},Bt=(r,n,h)=>{const f=oe(r,n,h),a=`M ${f.Bt.x} ${f.Bt.y}`,o=`A ${r} ${r} 0 0 0 ${f.At.x} ${f.At.y}`,s=`L  ${f.Ct.x} ${f.Ct.y}`,m=`A ${n} ${n} 0  0  1  ${f.Dt.x} ${f.Dt.y}`;return[a,o,s,m,"Z"].join(" ")},Dt=(r,n,h,f)=>{const a={x:r*-tt(f/2),y:r*A(f/2)},o={x:r*tt(f/2),y:r*A(f/2)},s={x:n*-tt(f/2),y:n*A(f/2)},m={x:n*tt(f/2),y:n*A(f/2)},v={x:a.x,y:r},d={x:o.x,y:r},b={x:a.x,y:s.y},y={x:o.x,y:s.y},M=E=>E+Math.abs(a.x),x=E=>r-E,t=E=>({x:M(E.x),y:x(E.y)}),e=t(a),c=t(o),g=t(s),_=t(m),u=t(v),i=t(d),l=t(b),p=t(y);console.log("[PrintViewWidget.WORKER] calc_points2  calc check:",{A:a,B:o,C:s,D:m},{TL:v,TR:d,BL:b,BR:y}),console.log("[PrintViewWidget.WORKER] calc_points2  transform check:",{At:e,Bt:c,Ct:g,Dt:_},{TLt:u,TRt:i,BLt:l,BRt:p});const w=(E,Z)=>({x:E.x*Z,y:E.y*Z}),k=w(e,h),R=w(c,h),L=w(g,h),Y=w(_,h),T=w(u,h),B=w(i,h),q=w(l,h),O=w(p,h);return console.log("[calculate_points] calc_points2  scale check ",{Ats:k,Bts:R,Cts:L,Dts:Y},{TLts:T,TRts:B,BLts:q,BRts:O}),{A:k,B:R,C:L,D:Y,TL:T,TR:B,BL:q,BR:O}},se=(r,n,h,f,a,o,s,m,v)=>new Promise((d,b)=>{if(v&&v.aborted)return console.log("[PrintViewWidget.WORKER] generatePreview aborted"),b(null);const y=()=>{console.log("[PrintViewWidget.WORKER] generatePreview.onAbort called"),cancelAnimationFrame(Wt),b(null)};if(v&&v.addEventListener("abort",y),r===null)return;const M=Kt(o),x=Rt(o),t=x.width+h.left+h.right+f.left+f.right,e=x.height+h.top+h.bottom+f.top+f.bottom,c={width:t,height:e},g=c.width/c.height,_=m.width/m.height,u=g>_?{width:m.width,height:m.width*c.height/c.width}:{height:m.height,width:m.height*c.width/c.height},i=u.width/c.width;console.log("[PrintViewWidget.WORKER] generatePreview started",{printSize:c,totalSize:m,obj_size_scaled:u,scaleFactor:i}),n.canvas.width=Math.round(u.width),n.canvas.height=Math.round(u.height);const l={top:h.top*i,left:h.left*i,right:h.right*i,bottom:h.bottom*i},p={top:f.top*i,left:f.left*i,right:f.right*i,bottom:f.bottom*i},w={width:x.width*i,height:x.height*i},k=w.width+l.left+l.right+p.left+p.right,R=w.height+l.top+l.bottom+p.top+p.bottom;if(console.log("[PrintViewWidget.WORKER] generatePreview totalSizePx",{printSize:c,totalSize:m,totalSizePx:{width:k,height:R}}),console.log("[PrintViewWidget.WORKER] generatePreview drawing data",{offset_px:l,margins_px:p,bounds_px:w}),n.save(),n.fillStyle="rgba(20, 217, 243, 0.5)",n.fillRect(0,0,u.width,u.height),n.fillStyle="rgb(252, 225, 175)",n.clearRect(l.left,l.top,u.width-(l.left+l.right),u.height-(l.top+l.bottom)),n.restore(),n.save(),n.translate(l.left,l.top),n.beginPath(),n.rect(0,0,w.width+p.left+p.right,w.height+p.top+p.bottom),n.setLineDash([5,5]),n.stroke(),n.restore(),M==="ellipse"){n.save(),n.beginPath(),n.translate(l.left,l.top);const Y=(o.horizontal_axis*i+p.left+p.right)/2,T=(o.vertical_axis*i+p.top+p.bottom)/2;n.setLineDash([5,5]),n.ellipse(Y,T,Y,T,0,0,2*Math.PI),n.stroke(),n.restore()}if(M==="circle"){n.save(),n.translate(l.left,l.top),n.beginPath();const Y=o.radius*i+(p.left+p.right)/2;n.setLineDash([5,5]),n.arc(Y,Y,Y,0,2*Math.PI),n.stroke(),n.restore()}if(M==="rect"&&(n.save(),n.translate(l.left,l.top),n.beginPath(),n.rect(0,0,w.width+p.left+p.right,w.height+p.top+p.bottom),n.setLineDash([5,5]),n.stroke(),n.restore()),M==="square"&&(n.save(),n.translate(l.left,l.top),n.beginPath(),n.rect(0,0,w.width+p.left+p.right,w.height+p.top+p.bottom),n.setLineDash([5,5]),n.stroke(),n.restore()),M==="round-corners-2"){n.save(),n.translate(l.left,l.top),n.setLineDash([5,5]);const Y=o.border_radius_tl;ne(n,0,0,w.width+p.left+p.right,w.height+p.top+p.bottom,Y*i),n.restore()}if(M==="cone"){n.save(),n.translate(l.left+p.left,l.top+p.top);const Y={top_diameter:o.top_radius,height:o.height,bottom_diameter:o.bottom_radius,gap_angle:mt(o.gap_angle)};n.strokeStyle="blue";const{R:T,r:B,fi_rad:q,gap_rad:O}=_t(Y),E={R:T*i,r:B*i,fi_rad:q,gap_rad:O},Z=Bt(E.R,E.r,E.fi_rad-E.gap_rad);let U=new Path2D(Z);n.setLineDash([5,5]),n.stroke(U),n.restore(),n.save(),n.strokeStyle="magenta",n.translate(l.left,l.top);const I=Dt(T,B,i,q-O),D=T+f.left/Math.tan((q-O)/2),j=D*B/T,et=Dt(D,j,i,q-O);console.log("[PrintViewWidget.WORKER] generatePreview calc_points2",{points:I,points2:et});const V=Bt(D*i,j*i,E.fi_rad-E.gap_rad);n.stroke(new Path2D(V)),n.restore()}if(M==="path"){const Y=w.width+p.left+p.right,T=w.height+p.top+p.bottom,B={width:Y,height:T},q=o.path;if(!Ut(q)){b(null);return}let O=re(q).inbox(`0 0 ${Y} ${T} meet xMinYMin`),E=O.toString(),Z=O.toBox();const U={width:Z.width(),height:Z.height()},I=ae({x:0,y:0,...B},U,"xMid","YMid");console.log("[PrintViewWidget.WORKER] calculateInboxFit",{_box_size:B,expanded_size:U,_fit:I});let D=new Path2D(E);n.save(),n.translate(l.left+I.x,l.top+I.y),n.beginPath(),n.setLineDash([5,5]),n.fillStyle="rgba(52, 202, 15, 0.1)",n.fill(D),n.stroke(D),n.restore()}n.drawImage(s,0,0,s.width,s.height,l.left+p.left,l.top+p.top,w.width,w.height),d(null)});self.onmessage=function(r){console.log("[PrintViewWidget.WORKER] onmessage",r.data);const n=r.data;switch(n.type){case"initCanvas":console.log("[PrintViewWidget.WORKER] initCanvas",r.data.type,n.bitmap);const h=n.canvas;h&&(z=h.getContext("2d"),n.bitmap&&(Q=n.bitmap),G=new OffscreenCanvas(0,0).getContext("2d"),postMessage({action:"canvas-init-callback",success:!0}));break;case"drawBitmap":try{dt.abort()}catch{}dt=new AbortController;const{offset:f,margin:a,borders:o,units:s,totalSize:m,copies:v,imageProps:d,printAreaProps:b,pageProps:y,orientation:M,regmarks:x,hoverIdx:t,clickMap:e,theme:c}=r.data;e!==void 0&&(J=Object.assign({},e)),z!==null&&(console.log("[PrintViewWidget.WORKER] starting execfn with args:",f,a,o,s,b,m,y,M,x,t),Wt=requestAnimationFrame(()=>se(z,G,f,a,s,b,Q,m,dt.signal).then(_=>{const u=new Date().getTime();let i=u;const{width:l,height:p}=G.canvas;console.log("[PrintViewWidget.WORKER1] generatePreview finished:",{object_width_pix:l,object_height_pix:p,imagebmp:Q});const k=new OffscreenCanvas(p,l).getContext("2d");k.translate(p,0),k.rotate(Math.PI/2),k.drawImage(G.canvas,0,0),Promise.all([G.canvas.convertToBlob({type:"image/png"}),k.canvas.convertToBlob({type:"image/png"})]).then(([R,L])=>{if(console.log("[PrintViewWidget.WORKER1] Blobs ready:",R,L),console.log("[PrintViewWidget.WORKER1] hoverIdx :",t),t===void 0){const T={url:URL.createObjectURL(R),width:l,height:p};postMessage({type:"export-object-png",res:T})}return Promise.all([createImageBitmap(R),createImageBitmap(L)])}).then(([R,L])=>{console.log("[PrintViewWidget.WORKER1] bitmaps are ready",{originalBitmap:R,rotatedBitmap:L}),i=new Date().getTime(),console.log("[PrintViewWidget.WORKER1] convertToBlob  finished, starting createObjectURL",i-u);const Y=Object.assign({width:0,height:0},m),T=y[s];let B=Y.height,q=Y.width,O=M==="portrait"?Math.max(T.width,T.height):Math.min(T.width,T.height),E=M==="portrait"?Math.min(T.width,T.height):Math.max(T.width,T.height);const Z=B/q,U=O/E;let I={width:0,height:0};if(Z<U){let S=Y.height/U,P=Y.height;I.width=S,I.height=P}else{let S=Y.width*U,P=Y.width;I.width=P,I.height=S}const D=Rt(b),j=Q.width/D.width,et=Math.round(s==="in"?j:j*25.4),V=Math.round(et/25.4),C=s==="mm"?V:et,he=D.width+f.left+f.right+a.left+a.right,ce=D.height+f.top+f.bottom+a.top+a.bottom,Ot={width:he,height:ce},it={top:f.top*C,left:f.left*C,right:f.right*C,bottom:f.bottom*C},rt={top:a.top*C,left:a.left*C,right:a.right*C,bottom:a.bottom*C},Ft={width:D.width*C,height:D.height*C},le=Ft.width+it.left+it.right+rt.left+rt.right,fe=Ft.height+it.top+it.bottom+rt.top+rt.bottom,N={width:le,height:fe};N.width=Number(N.width.toFixed(0)),N.height=Number(N.height.toFixed(0));const $={top:o.top*C,left:o.left*C,right:o.right*C,bottom:o.bottom*C},X={top:x.offset.top*C,left:x.offset.left*C,right:x.offset.right*C,bottom:x.offset.bottom*C},It={top:x.safe_area.top*C,left:x.safe_area.left*C,right:x.safe_area.right*C,bottom:x.safe_area.bottom*C},ue=M==="portrait"?T.width:T.height,pe=M==="portrait"?T.height:T.width,at={width:ue,height:pe},K={width:at.width*C,height:at.height*C};K.width=Number(K.width.toFixed(0)),K.height=Number(K.height.toFixed(0));const nt={width:at.width-(o.left+o.right),height:at.height-(o.top+o.bottom)},W={width:nt.width*C,height:nt.height*C};W.width=Number(W.width.toFixed(0)),W.height=Number(W.height.toFixed(0));const gt={width:nt.width-(x.enabled?x.offset.left+x.offset.right+x.safe_area.left+x.safe_area.right:0),height:nt.height-(x.enabled?x.offset.top+x.offset.bottom+x.safe_area.top+x.safe_area.bottom:0)},H={width:gt.width*C,height:gt.height*C};if(H.width=Number(H.width.toFixed(0)),H.height=Number(H.height.toFixed(0)),console.log("[PrintViewWidget.WORKER1] sizes render",{viewbox:I,page_size:T,borders:o,borders_px:$},{boundaries:D,margin:a,offset:f,obj_size:Ot,obj_size_px:N,imagebmp:Q}),z===null)return;if(z.canvas.width=Math.round(K.width),z.canvas.height=Math.round(K.height),z.save(),z.fillStyle="floralwhite",z.fillRect(0,0,z.canvas.width,z.canvas.height),z.strokeStyle="black",z.setLineDash([5,5]),z.strokeRect(0,0,z.canvas.width,z.canvas.height),z.restore(),z.save(),z.fillStyle="rgba(243, 20, 20, 0.5)",z.fillRect(0,0,K.width,K.height),z.fillStyle=c==="light"?"floralwhite":"hsla(225, 3%, 27%, 1.00)",z.fillRect($.left,$.top,K.width-($.left+$.right),K.height-($.top+$.bottom)),z.restore(),x.enabled){z.save(),z.translate($.left,$.top),z.fillStyle="rgba(170, 255, 162, 0.5)",z.fillRect(0,0,W.width,W.height),z.fillStyle="rgba(7, 190, 23, 0.5)",z.fillRect(X.left,X.top,W.width-X.left-X.right,W.height-X.top-X.bottom),z.fillStyle="floralwhite",z.fillRect(It.left+X.left,It.top+X.top,H.width,H.height),z.fillStyle="rgba(0, 0, 0, 1)",z.fillRect(X.left,X.top,V*5,V*5);const S=V*20,P=V*1;z.fillRect(W.width-X.left-S,X.top,S,P),z.fillRect(W.width-X.left-P,X.top,P,S),z.fillRect(X.left,W.height-X.top-S,P,S),z.fillRect(X.left,W.height-X.top-P,S,P);const F=new Path2D(`
                                            M${W.width-X.left-X.right-S-P} ${P}
                                            L${W.width-X.left-X.right-P} ${P} 
                                            L${W.width-X.left-X.right-P} ${S+P}              // top-left corner
                                     
                                        `);console.log("[PrintViewWidget.WORKER1] regmarks generated path",{path:F,L1mm:P,L20mm:S,regmarks_offset_px:X,page_print_size_no_borders_px:W}),z.restore()}const de=$.left+(x.enabled?x.offset.left+x.safe_area.left:0)*C,ge=$.top+(x.enabled?x.offset.top+x.safe_area.top:0)*C;let me=Zt(H.width,H.height,N.width,N.height);console.log("[PrintViewWidget.WORKER1.drawBitmap]  sizes",{copies:v,page_print_size_no_borders_no_marks:gt,obj_size:Ot,_clickMap:J});let Vt=0;me.map((S,P)=>{const F={...S,width:S.rotated?N.height:N.width,height:S.rotated?N.width:N.height,hover:P===t},_e=!Object.values(J).some(we=>!!we);return z&&(_e?z.globalAlpha=F.hover||Vt<v?1:.5:z.globalAlpha=J[P]===!1?.5:1,Vt+=1,z.save(),z.strokeStyle=J[P]===!0?"blue":F.hover?"red":"black",z.lineWidth=Math.ceil(V/3)+2*V/3*Number(F.hover),z.setLineDash([V,V]),z.translate(de,ge),z.strokeRect(S.x,S.y,F.width,F.height),S.rotated?z.drawImage(L,0,0,L.width,L.height,S.x,S.y,F.width,F.height):z.drawImage(R,0,0,R.width,R.height,S.x,S.y,F.width,F.height),z.restore()),F})})})));break}}})();
