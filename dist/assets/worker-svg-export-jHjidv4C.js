(function(){"use strict";const lt=e=>{const p=e*180/Math.PI;return parseFloat(p.toFixed(1))},dt=e=>e*Math.PI/180,mt=e=>{const{top_diameter:p,bottom_diameter:o,height:_,gap_angle:a}=e,s=p,n=o,w=_,v=Math.sqrt(Math.pow(s,2)/4+Math.pow(s*w/(s-n),2)),d=Math.sqrt(Math.pow(n,2)/4+Math.pow(n*w/(s-n),2)),x=Math.PI*s/v,M=x*180/Math.PI,b=a/360*M,z=dt(b);return{R:v,r:d,fi_rad:x,gap_rad:z}},pt=e=>{const{R:p,r:o,fi_rad:_,gap_rad:a}=mt(e),s=_-a,n=p*Math.sin(s/2)*2,w=p-o*Math.cos(s/2);return{width:n,height:w}};function H(e){return"side"in e}function $(e){return"width"in e&&"height"in e&&!("border_radius"in e)&&!("border_radius_tl"in e)&&!("path"in e)}function Q(e){return"width"in e&&"height"in e&&"border_radius"in e}function G(e){return"width"in e&&"height"in e&&("border_radius_tl"in e&&"border_radius_tr"in e&&"border_radius_bl"in e&&"border_radius_br"in e||"border_radius"in e)}function J(e){return"radius"in e}function A(e){return"top_radius"in e&&"bottom_radius"in e}function j(e){return"vertical_axis"in e&&"horizontal_axis"in e}function tt(e){return"width"in e&&"height"in e&&"path"in e}const R=e=>{let p={width:0,height:0};if(H(e)){const{side:o}=e;({...e},p={width:o,height:o})}if($(e)){const{width:o,height:_}=e;p={width:o,height:_},{...e}}if(Q(e)){const{width:o,height:_}=e;p={width:o,height:_},{...e}}if(G(e)){const{width:o,height:_}=e;p={width:o,height:_},{...e}}if(J(e)){const{radius:o}=e;p={width:2*o,height:2*o},{...e}}if(A(e)){const{top_radius:o,bottom_radius:_,height:a,gap_angle:s}=e,n={top_diameter:o,bottom_diameter:_,height:a,gap_angle:lt(s)};p=pt(n),{...e}}if(j(e)){const{horizontal_axis:o,vertical_axis:_}=e;p={width:o,height:_},{...e}}if(tt(e)){const{width:o,height:_}=e;p={width:o,height:_},{...e}}return p},gt=e=>{let p=null;if(p=H(e)?"square":$(e)?"rect":Q(e)?"round-corners":G(e)?"round-corners-2":J(e)?"circle":A(e)?"cone":j(e)?"ellipse":tt(e)?"path":null,p===null)throw new Error("Invalid printareaprops value");return p};function W(e){return typeof e!="string"?!1:(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4))}function _t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var I,et;function wt(){if(et)return I;et=1;var e=[];return e[97]=7,e[99]=6,e[104]=1,e[108]=2,e[109]=2,e[113]=4,e[115]=4,e[116]=2,e[118]=1,e[122]=0,I=function(o){var _=o.length,a,s,n,w,v=0,d=!1,x="",M,b=!1,z=!1,t=[],i=[],h=[];function u(l){h.push({position:a,segment:t.length+1,message:l})}for(a=0;a<=_;a++)if(s=o[a]||"z",n=s.toLowerCase().charCodeAt(0),!(48<=n&&n<=57&&(x+=s,d=!0,i[0]!=="A"&&i[0]!=="a"||n>49||v<3||v>4))){if((n===45||n===43)&&(!d||z&&x[x.length-1]==="e")){x+=s,d=!0;continue}if(n===46&&!b&&!z){x+=s,d=!0,b=!0;continue}if(n===101&&d&&!isNaN(x)){x+="e",d=!0,z=!0;continue}if(d&&(w?(M=+x,isNaN(x)?u("Bad formated number ["+x+"]. I'll ignore it."):(i.push(M),v++)):u("Non expected number ["+x+"] at this place. I'll ignore it."),x="",d=z=b=!1),v===w&&i.length)switch((i[0]==="A"||i[0]==="a")&&(i[4]=i[4]?1:0,i[5]=i[5]?1:0),t.length===0&&i[0]!=="m"&&i[0]!=="M"&&(u("The path must start with M or m. I add 'M 0 0' for you."),t.push(["M",0,0])),t.push(i),v=0,i[0]){case"M":i=["L"];break;case"m":i=["l"];break;case"Z":case"z":i=[];break;default:i=[i[0]]}if(!(n===32||n===9||n===10||n===13||n===44)){if(n===43||n===45||n===46){x=s,b=n===46,d=!0;continue}if(!e.hasOwnProperty(n)){u("Non expected character ["+s+"]. I'll ignore it.");continue}w=e[n],i.length>1&&u("Non complete segment ["+i.join(" ")+"]. I'll ignore it."),i=[s],v=0}}return i.length>1&&u("Non complete segment ["+i.join(" ")+"] (at the end of the path). I'll ignore it."),{errs:h,segments:t}},I}var F,it;function rt(){if(it)return F;it=1;function e(o,_){return[o[0]*_[0]+o[2]*_[1],o[1]*_[0]+o[3]*_[1],o[0]*_[2]+o[2]*_[3],o[1]*_[2]+o[3]*_[3],o[0]*_[4]+o[2]*_[5]+o[4],o[1]*_[4]+o[3]*_[5]+o[5]]}function p(o){if(!(this instanceof p))return new p(o);if(!o)o=[];else switch(o.constructor){case String:o=o.trim().split(/\s+/).map(parseFloat);break;case p:o=o.toArray();break;case Array:break;default:o=[]}this.matrix=o.slice().concat([1,0,0,1,0,0].slice(o.length))}return p.prototype.copy=function(o){return new p(this.matrix)},p.prototype.isIdentity=function(o){return o?(this.matrix[0]-1)*(this.matrix[0]-1)+this.matrix[1]*this.matrix[1]+this.matrix[2]*this.matrix[2]+(this.matrix[3]-1)*(this.matrix[3]-1)+this.matrix[4]*this.matrix[4]+this.matrix[5]*this.matrix[5]<o:this.matrix[0]===1&&this.matrix[1]===0&&this.matrix[2]===0&&this.matrix[3]===1&&this.matrix[4]===0&&this.matrix[5]===0},p.prototype.preserveH=function(){return!this.matrix[1]},p.prototype.preserveV=function(){return!this.matrix[2]},p.prototype.det=function(){return this.matrix[0]*this.matrix[3]-this.matrix[1]*this.matrix[2]},p.prototype.reset=function(){return this.matrix=[1,0,0,1,0,0],this},p.prototype.compose=function(o){return(!o||o.constructor!==p)&&(o=new p(o)),o.isIdentity()?this:(this.matrix=e(o.matrix,this.matrix),this)},p.prototype.translate=function(o,_){return this.matrix[4]+=o,this.matrix[5]+=_,this},p.prototype.scale=function(o,_){return(o!==1||_!==1)&&(this.matrix[0]*=o,this.matrix[2]*=o,this.matrix[4]*=o,this.matrix[1]*=_,this.matrix[3]*=_,this.matrix[5]*=_),this},p.prototype.rotate=function(o,_,a){var s,n,w;return o!==0&&(s=o*Math.PI/180,n=Math.cos(s),w=Math.sin(s),this.translate(-_,-a).compose([n,w,-w,n,0,0]).translate(_,a)),this},p.prototype.skewX=function(o){return o!==0&&this.compose([1,0,Math.tan(o*Math.PI/180),1,0,0]),this},p.prototype.skewY=function(o){return o!==0&&this.compose([1,Math.tan(o*Math.PI/180),0,1,0,0]),this},p.prototype.toArray=function(){return this.matrix},p.prototype.calc=function(o,_,a){return[this.matrix[0]*o+this.matrix[2]*_+(a?0:this.matrix[4]),this.matrix[1]*o+this.matrix[3]*_+(a?0:this.matrix[5])]},F=p,F}var O,at;function vt(){if(at)return O;at=1;var e=rt(),p={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},o=/\s*((?:matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(?:.+?)\s*\))[\s,]*/,_=/[\s(),]+/;return O=function(s){var n=e(),w,v,d;w=s.split(o).filter(Boolean);for(var x=w.length-1;x>=0;x--)if(d=w[x].split(_).filter(Boolean),!(d.length<2))switch(v=d.shift(),p[v]&&(d=d.map(parseFloat)),v){case"matrix":(d.length===6||d.length===4)&&n.compose(d);break;case"scale":d.length===1?n.scale(d[0],d[0]):d.length===2&&n.scale(d[0],d[1]);break;case"rotate":d.length===1?n.rotate(d[0],0,0):d.length===3&&n.rotate(d[0],d[1],d[2]);break;case"translate":d.length===1?n.translate(d[0],0):d.length===2&&n.translate(d[0],d[1]);break;case"skewX":d.length===1&&n.skewX(d[0]);break;case"skewY":d.length===1&&n.skewY(d[0]);break}return n},O}var D,nt;function xt(){if(nt)return D;nt=1;var e=Math.PI*2;function p(a,s,n,w){var v=a*w-s*n<0?-1:1,d=a*n+s*w;return d>1&&(d=1),d<-1&&(d=-1),v*Math.acos(d)}function o(a,s,n,w,v,d,x,M,b,z){var t=z*(a-n)/2+b*(s-w)/2,i=-b*(a-n)/2+z*(s-w)/2,h=x*x,u=M*M,l=t*t,c=i*i,r=h*u-h*c-u*l;r<0&&(r=0),r/=h*c+u*l,r=Math.sqrt(r)*(v===d?-1:1);var f=r*x/M*i,m=r*-M/x*t,g=z*f-b*m+(a+n)/2,y=b*f+z*m+(s+w)/2,C=(t-f)/x,Y=(i-m)/M,S=(-t-f)/x,P=(-i-m)/M,L=p(1,0,C,Y),X=p(C,Y,S,P);return d===0&&X>0&&(X-=e),d===1&&X<0&&(X+=e),[g,y,L,X]}function _(a,s){var n=1.3333333333333333*Math.tan(s/4),w=Math.cos(a),v=Math.sin(a),d=Math.cos(a+s),x=Math.sin(a+s);return[w,v,w-v*n,v+w*n,d+x*n,x-d*n,d,x]}return D=function(s,n,w,v,d,x,M,b,z){var t=Math.sin(z*e/360),i=Math.cos(z*e/360),h=i*(s-w)/2+t*(n-v)/2,u=-t*(s-w)/2+i*(n-v)/2;if(h===0&&u===0)return[];if(M===0||b===0)return[];M=Math.abs(M),b=Math.abs(b);var l=h*h/(M*M)+u*u/(b*b);l>1&&(M*=Math.sqrt(l),b*=Math.sqrt(l));var c=o(s,n,w,v,d,x,M,b,t,i),r=[],f=c[2],m=c[3],g=Math.max(Math.ceil(Math.abs(m)/(e/4)),1);m/=g;for(var y=0;y<g;y++)r.push(_(f,m)),f+=m;return r.map(function(C){for(var Y=0;Y<C.length;Y+=2){var S=C[Y+0],P=C[Y+1];S*=M,P*=b;var L=i*S-t*P,X=t*S+i*P;C[Y+0]=L+c[0],C[Y+1]=X+c[1]}return C})},D}var N,ht;function Mt(){if(ht)return N;ht=1;var e=Math.PI/180;function p(o,_,a,s){if(!(this instanceof p))return new p(o,_,a,s);this.rx=o,this.ry=_,this.ax=a,this.epsilon=typeof s>"u"?1e-7:+("1e"+-s)}return p.prototype.transform=function(o){var _=Math.cos(this.ax*e),a=Math.sin(this.ax*e),s=[this.rx*(o[0]*_+o[2]*a),this.rx*(o[1]*_+o[3]*a),this.ry*(-o[0]*a+o[2]*_),this.ry*(-o[1]*a+o[3]*_)],n=s[0]*s[0]+s[2]*s[2],w=s[1]*s[1]+s[3]*s[3],v=Math.sqrt(((s[0]-s[3])*(s[0]-s[3])+(s[2]+s[1])*(s[2]+s[1]))*((s[0]+s[3])*(s[0]+s[3])+(s[2]-s[1])*(s[2]-s[1]))),d=(n+w)/2;if(v<=this.epsilon)return this.rx=this.ry=Math.sqrt(d),this.ax=0,this;if(Math.abs(v-Math.abs(n-w))<=this.epsilon)return this.rx=Math.sqrt(n),this.ry=Math.sqrt(w),this.ax=0,this;var x=s[0]*s[1]+s[2]*s[3],M=d+v/2,b=d-v/2;return Math.abs(x)<=this.epsilon&&Math.abs(M-w)<=this.epsilon?(this.ax=0,this.rx=Math.sqrt(b),this.ry=Math.sqrt(M),this):(this.ax=Math.atan(Math.abs(x)>Math.abs(M-w)?(M-n)/x:x/(M-w))/e,this.ax>=0?(this.rx=Math.sqrt(M),this.ry=Math.sqrt(b)):(this.ax+=90,this.rx=Math.sqrt(b),this.ry=Math.sqrt(M)),this)},p.prototype.isDegenerate=function(){return Math.abs(this.rx)<=this.epsilon||Math.abs(this.ry)<=this.epsilon},p.prototype.normalise=function(o,_){if(this.rx=Math.abs(this.rx),this.ry=Math.abs(this.ry),Math.abs(this.rx-this.ry)<=this.epsilon)this.ax=0,this.rx=this.ry=(this.rx+this.ry)/2;else if(this.ax=this.ax%180,this.ax<0&&(this.ax+=180),this.ax>=90){var a;a=this.rx,this.rx=this.ry,this.ry=a,this.ax=this.ax-90}if(!o&&!_)return this;var s=Math.cos(this.ax*e),n=Math.sin(-this.ax*e),w=(o*s-_*n)/this.rx,v=(o*n+_*s)/this.ry,d=Math.sqrt(w*w+v*v);return d>1&&(this.rx*=d,this.ry*=d),this},N=p,N}var B,st;function bt(){if(st)return B;st=1;function e(a){if(!(this instanceof e))return new e(a);if(a&&a.constructor===String){var s=a.trim().split(/\s+/).map(parseFloat);this.addX(s[0]).addX(s[0]+s[2]).addY(s[1]).addY(s[1]+s[3])}return this}e.prototype.copy=function(){var a=new e;return a.minX=this.minX,a.minY=this.minY,a.maxX=this.maxX,a.maxY=this.maxY,a},e.prototype.width=function(){return typeof this.minX>"u"?0:this.maxX-this.minX},e.prototype.height=function(){return typeof this.minY>"u"?0:this.maxY-this.minY},e.prototype.isUndefined=function(){return typeof this.minX>"u"||typeof this.minY>"u"},e.prototype.addX=function(a){return typeof this.minX>"u"?this.minX=this.maxX=a:(this.minX=Math.min(this.minX,a),this.maxX=Math.max(this.maxX,a)),this},e.prototype.addY=function(a){return typeof this.minY>"u"?this.minY=this.maxY=a:(this.minY=Math.min(this.minY,a),this.maxY=Math.max(this.maxY,a)),this},e.prototype.addPoint=function(a,s){return this.addX(a).addY(s)};function p(a){var s=Math.min(a[0],a[2]),n=Math.max(a[0],a[2]);if(a[1]>a[0]?a[2]>=a[1]:a[2]<=a[1])return[s,n];var w=(a[0]*a[2]-a[1]*a[1])/(a[0]-2*a[1]+a[2]);return w<s?[w,n]:[s,w]}e.prototype.addXQ=function(a){var s=p(a);return this.addX(s[0]).addX(s[1])},e.prototype.addYQ=function(a){var s=p(a);return this.addY(s[0]).addY(s[1])};var o=1e-8;function _(a){var s=a[0]-3*a[1]+3*a[2]-a[3];if(Math.abs(s)<o)return p([a[0],-.5*a[0]+1.5*a[1],a[0]-3*a[1]+3*a[2]]);var n=-a[0]*a[2]+a[0]*a[3]-a[1]*a[2]-a[1]*a[3]+a[1]*a[1]+a[2]*a[2];if(n<=0)return[Math.min(a[0],a[3]),Math.max(a[0],a[3])];for(var w=Math.sqrt(n),v=Math.max(a[0],a[3]),d=Math.min(a[0],a[3]),x=a[0]-2*a[1]+a[2],M=(x+w)/s,b=1;b<=2;M=(x-w)/s,b++)if(M>0&&M<1){var z=a[0]*(1-M)*(1-M)*(1-M)+a[1]*3*(1-M)*(1-M)*M+a[2]*3*(1-M)*M*M+a[3]*M*M*M;z<d&&(d=z),z>v&&(v=z)}return[d,v]}return e.prototype.addXC=function(a){var s=_(a);return this.addX(s[0]).addX(s[1])},e.prototype.addYC=function(a){var s=_(a);return this.addY(s[0]).addY(s[1])},e.prototype.toArray=function(){return this.isUndefined()?[0,0,0,0]:[this.minX,this.minY,this.maxX,this.maxY]},e.prototype.toString=function(a){return this.isUndefined()?"0 0 0 0":(typeof a>"u"?[this.minX,this.minY,this.width(),this.height()]:[this.minX.toFixed(a),this.minY.toFixed(a),this.width().toFixed(a),this.height().toFixed(a)]).join(" ")},e.prototype.inboxMatrix=function(a){var s=new e(a.match(/(-|\d|\.|\s)+/)[0]),n=(a+"meet").match(/(fit|none|meet|slice|move)/)[0];n==="none"&&(n="fit");var w,v;switch(n){case"fit":w=this.width()?s.width()/this.width():1,v=this.height()?s.height()/this.height():1;break;case"slice":if(this.width()!==0&&this.height()!==0){w=v=Math.max(s.width()/this.width(),s.height()/this.height());break}case"meet":w=v=this.width()===0&&this.height()===0?1:Math.min(s.width()/this.width(),s.height()/this.height());break;case"move":w=v=1;break}var d={};d.X=(a+"xMid").match(/x(Min|Mid|Max)/i)[1].toLowerCase(),d.Y=(a+"YMid").match(/Y(Min|Mid|Max)/i)[1].toLowerCase();var x={},M={};M.src=this,M.dst=s;for(var b="X",z=1;z<=2;b="Y",z++)for(var t="src",i=1;i<=2;t="dst",i++)switch(d[b]){case"min":x[t+b]=M[t]["min"+b];break;case"mid":x[t+b]=(M[t]["min"+b]+M[t]["max"+b])/2;break;case"max":x[t+b]=M[t]["max"+b];break}return[w,0,0,v,x.dstX-w*x.srcX,x.dstY-v*x.srcY]},B=e,B}var K,ot;function yt(){if(ot)return K;ot=1;var e=wt(),p=vt(),o=rt(),_=xt(),a=Mt(),s=bt();function n(t){if(!(this instanceof n))return new n(t);var i=e(t);this.segments=i.segments,this.errs=i.errs,this.affineTransform=o()}n.prototype.precision=7,n.prototype.copy=function(){for(var t=new n(""),i=0,h=this.segments.length;i<h;i++)t.segments[i]=this.segments[i].slice(0);return t.errs=this.errs,t.affineTransform=this.affineTransform.copy(),t},n.prototype.hasErrors=function(){return this.errs.length>0},n.prototype.errors=function(){var t=[],i=this.errs.length,h;for(h=0;h<i;h++)t.push("[pos:"+this.errs[h].position+", seg:"+this.errs[h].segment+"] "+this.errs[h].message);return t.join(`
`)},n.prototype.toArray=function(t){return t=!!t,this.doTransform().round(this.precision),t&&this.hasErrors()?this.segments.concat.apply([],this.segments.slice(0,this.errs[0].segment-1)):this.segments.concat.apply([],this.segments)};function w(t,i){if(t.length<=1)return null;var h=[0,0],u;switch(t[0]){case"h":case"H":h[0]=t[1],h[1]=t[0]==="h"?0:i[1];break;case"v":case"V":h[0]=t[0]==="v"?0:i[0],h[1]=t[1];break;default:u=t.length-2,h[0]=t[u],h[1]=t[u+1]}return t[0]===t[0].toLowerCase()&&(h[0]+=i[0],h[1]+=i[1]),h}n.prototype.iterate=function(t){var i=this,h=this.segments,u=[],l=[],c=[0,0],r=[0,0];if(h.forEach(function(g,y){var C=c[0],Y=c[1],S;g[0]==="z"||g[0]==="Z"?c=r.slice():(c=w(g,c),(g[0]==="m"||g[0]==="M")&&(r=c.slice())),S=t.call(i,g,y,C,Y),Array.isArray(S)&&(u[y]=S)}),u.length===0)return this;for(var f=0,m=h.length;f<m;f++)typeof u[f]<"u"?l.push.apply(l,u[f]):l.push(h[f]);return this.segments=l,this};function v(t,i){t.iterate(function(h,u,l,c){var r,f,m,g;switch(h[0]){case"v":r=i.calc(0,h[1],!0),f=i.preserveV()?["v",r[1]]:["l",r[0],r[1]];break;case"V":r=i.calc(l,h[1],!1),f=i.preserveV()?["V",r[1]]:["L",r[0],r[1]];break;case"h":r=i.calc(h[1],0,!0),f=i.preserveH()?["h",r[0]]:["l",r[0],r[1]];break;case"H":r=i.calc(h[1],c,!1),f=i.preserveH()?["H",r[0]]:["L",r[0],r[1]];break;case"a":case"A":var y=a(h[1],h[2],h[3],this.precision).transform(i.toArray());r=i.calc(h[6],h[7],h[0]==="a"),y.isDegenerate()?f=[h[0]==="a"?"l":"L",r[0],r[1]]:(i.det()<0&&(h[5]=h[5]?0:1),f=[h[0],y.rx,y.ry,y.ax,h[4],h[5],r[0],r[1]]);break;default:m=h[0],f=[m],g=m.toLowerCase()===m&&u;for(var C=1,Y=h.length;C<Y;C+=2)r=i.calc(h[C],h[C+1],g),f.push(r[0],r[1])}return[f]})}n.prototype.doTransform=function(){return this.affineTransform.isIdentity()?this:(v(this,this.affineTransform),this.affineTransform.reset(),this)},n.prototype.translate=function(t,i){return this.affineTransform.translate(t,i||0),this},n.prototype.scale=function(t,i){return this.affineTransform.scale(t,isNaN(i)?t:i),this},n.prototype.rotate=function(t,i,h){return this.affineTransform.rotate(t,i||0,h||0),this},n.prototype.skewX=function(t){return this.affineTransform.skewX(t),this},n.prototype.skewY=function(t){return this.affineTransform.skewY(t),this},n.prototype.matrix=function(t){return this.affineTransform.compose(t),this},n.prototype.transform=function(t){return t.trim()?(this.affineTransform.compose(p(t)),this):this};function d(t,i){return i=~~i,i===0?Math.round(t):(t=+t,isNaN(t)?NaN:(t=t.toString().split("e"),t=Math.round(+t[0]+"e"+(~~t[1]+i)),t=t.toString().split("e"),+(t[0]+"e"+(~~t[1]-i))))}n.prototype.round=function(t){this.precision=t=~~t;var i=0,h=0,u=0,l=0;return this.doTransform(),this.segments.forEach(function(c){var r=c[0].toLowerCase()===c[0],f,m,g;switch(c[0]){case"H":case"h":r&&(c[1]+=u),f=c[1],c[1]=d(f,t),u=f-c[1];return;case"V":case"v":r&&(c[1]+=l),m=c[1],c[1]=d(m,t),l=m-c[1];return;case"Z":case"z":u=i,l=h;return;case"A":case"a":c[1]=d(c[1],t),c[2]=d(c[2],t),c[3]=d(c[3],t+2),r&&(c[6]+=u,c[7]+=l),f=c[6],m=c[7],c[6]=d(f,t),c[7]=d(m,t),u=f-c[6],l=m-c[7];return;default:for(g=c.length-3,r&&(c[g+1]+=u,c[g+2]+=l),f=c[g+1],m=c[g+2],c[g+1]=d(f,t),c[g+2]=d(m,t),u=f-c[g+1],l=m-c[g+2];g>0;g--)c[g]=d(c[g],t);c[0].toLowerCase()==="m"&&(i=u,h=l);return}}),this},n.prototype.abs=function(){return this.iterate(function(t,i,h,u){var l=t[0],c=l.toUpperCase();if(l!==c)switch(t[0]=c,l){case"v":t[1]+=u;return;case"a":t[6]+=h,t[7]+=u;return;default:for(var r=1,f=t.length;r<f;r++)t[r]+=r%2?h:u}}),this},n.prototype.rel=function(){return this.iterate(function(t,i,h,u){var l=t[0],c=l.toLowerCase();if(l!==c&&!(i===0&&l==="M"))switch(t[0]=c,l){case"V":t[1]-=u;return;case"A":t[6]-=h,t[7]-=u;return;default:for(var r=1,f=t.length;r<f;r++)t[r]-=r%2?h:u}}),this},n.prototype.unarc=function(){return this.iterate(function(t,i,h,u){var l,c,r,f=[],m=t[0];return m!=="A"&&m!=="a"?null:(m==="a"?(c=h+t[6],r=u+t[7]):(c=t[6],r=t[7]),l=_(h,u,c,r,t[4],t[5],t[1],t[2],t[3]),l.forEach(function(g){f.push(["C",g[2],g[3],g[4],g[5],g[6],g[7]])}),f)}),this},n.prototype.unshort=function(){var t=this.segments,i,h,u,l,c;return this.iterate(function(r,f,m,g){var y=r[0],C=y.toUpperCase(),Y;f&&(C==="T"?(Y=y==="t",u=t[f-1],u[0]==="Q"?(i=u[1]-m,h=u[2]-g):u[0]==="q"?(i=u[1]-u[3],h=u[2]-u[4]):(i=0,h=0),l=-i,c=-h,Y||(l+=m,c+=g),t[f]=[Y?"q":"Q",l,c,r[1],r[2]]):C==="S"&&(Y=y==="s",u=t[f-1],u[0]==="C"?(i=u[3]-m,h=u[4]-g):u[0]==="c"?(i=u[3]-u[5],h=u[4]-u[6]):(i=0,h=0),l=-i,c=-h,Y||(l+=m,c+=g),t[f]=[Y?"c":"C",l,c,r[1],r[2],r[3],r[4]]))}),this},n.prototype.reverse=function(){var t=0,i=0,h,u;this.unshort(),this.segments.push(["M",0,0]),this.iterate(function(r,f,m,g){var y=r[0];if(!f&&y.toUpperCase()==="M")return t=r[1],i=r[2],[];switch(y){case"M":t=r[1],i=r[2],r[1]=m,r[2]=g;break;case"L":r[1]=m,r[2]=g;break;case"m":t=m+r[1],i=g+r[2],r[1]=-r[1],r[2]=-r[2];break;case"l":r[1]=-r[1],r[2]=-r[2];break;case"H":r[1]=m;break;case"h":r[1]=-r[1];break;case"V":r[1]=g;break;case"v":r[1]=-r[1];break;case"Z":r[1]=m,r[2]=g;break;case"z":r[1]=m-t,r[2]=g-i;break;case"Q":r[3]=m,r[4]=g;break;case"q":r[1]-=r[3],r[2]-=r[4],r[3]=-r[3],r[4]=-r[4];break;case"C":r[5]=m,r[6]=g,h=r[3],u=r[4],r[3]=r[1],r[4]=r[2],r[1]=h,r[2]=u;break;case"c":h=r[1],u=r[2],r[1]=r[3]-r[5],r[2]=r[4]-r[6],r[3]=h-r[5],r[4]=u-r[6],r[5]=-r[5],r[6]=-r[6];break;case"A":r[6]=m,r[7]=g,r[5]=r[5]?0:1;break;case"a":r[6]=-r[6],r[7]=-r[7],r[5]=r[5]?0:1;break}}),this.segments.reverse();var l=!1,c=!1;return this.iterate(function(r,f,m,g){var y=null;switch(r[0]){case"z":r[0]="l",y=l?[["z"],["l",r[1],r[2]]]:c?null:[["m",0,0],["l",r[1],r[2]]],l=!0;break;case"Z":r[0]="L",y=l?[["Z"],["L",r[1],r[2]]]:c?null:[["m",0,0],["L",r[1],r[2]]],l=!0;break;case"m":y=l?[["z"],["m",r[1],r[2]]]:null,l=!1,c=!0;break;case"M":y=l?[["Z"],["M",r[1],r[2]]]:null,l=!1,c=!0;break;default:c=!1,y=null;break}return y}),l&&this.segments.push(["Z"]),this};function x(t,i){var h=w(t,i);if(t[0]==="z"||t[0]==="Z"||h[0]!==i[0]||h[1]!==i[1])return!1;switch(t[0]){case"c":return t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0;case"C":return t[1]===i[0]&&t[2]===i[1]&&t[3]===i[0]&&t[4]===i[1];case"s":case"q":return t[1]===0&&t[2]===0;case"S":case"Q":return t[1]===i[0]&&t[2]===i[1]}return!0}function M(t,i){return t&&(t[0]==="S"||t[0]==="s"||t[0]==="T"||t[0]==="t")}n.prototype.normalize_first_m=!0,n.prototype.normalize_remove_empty=!0,n.prototype.normalize_smash_m=!0,n.prototype.normalize_smash_z=!0,n.prototype.normalize_a2l=!0,n.prototype.normalize_arc_ellipse=!0,n.prototype.normalize_arc_flags=!1,n.prototype.parseNormalizeFlags=function(t){if(typeof t=="string"){var i;i=t.match(/[Ff]/),i&&(this.normalize_first_m=i[0]==="F"),i=t.match(/[Ee]/),i&&(this.normalize_remove_empty=i[0]==="E"),i=t.match(/[Mm]/),i&&(this.normalize_smash_m=i[0]==="M"),i=t.match(/[Zz]/),i&&(this.normalize_smash_z=i[0]==="Z"),i=t.match(/[Ll]/),i&&(this.normalize_a2l=i[0]==="L"),i=t.match(/[Ee]/),i&&(this.normalize_arc_ellipse=i[0]==="E"),i=t.match(/[Gg]/),i&&(this.normalize_arc_flags=i[0]==="G")}},n.prototype.normalize=function(t){this.parseNormalizeFlags(t);var i=null,h,u,l,c,r=this.segments;return this.iterate(function(f,m,g,y){if(m===0)return this.normalize_first_m&&f[0]==="m"&&(f[0]="M"),i=f,null;if(u=f[0].toLowerCase(),l=i&&i[0].toLowerCase(),h=w(f,[g,y]),this.normalize_remove_empty&&u!=="m"&&x(f,[g,y])){if(!M(r[m+1]))return[];if(u==="c"||u==="s"||u==="q"||u==="t"||u==="a")return u===f[0]?(f[0]="l",f[1]=f[2]=0):(f[0]="L",f[1]=h[0],f[2]=h[1]),f.splice(3),null}if(this.normalize_smash_m&&i&&l==="m"&&u==="m")return i[0]="M",i[1]=h[0],i[2]=h[1],[];if(this.normalize_smash_z&&i&&l==="z"&&u==="z")return[];if(u==="a"){if(c=a(f[1],f[2],f[3],this.precision),this.normalize_a2l&&c.isDegenerate())return f[0]=f[0]===u?"l":"L",f[1]=f[6],f[2]=f[7],f.splice(3),i=f,null;this.normalize_arc_ellipse&&(c.normalise((h[0]-g)/2,(h[1]-y)/2),f[1]=c.rx,f[2]=c.ry,f[3]=c.ax),this.normalize_arc_flags&&(f[4]=f[4]?1:0,f[5]=f[5]?1:0)}return i=f,null}),this},n.prototype.normalize_before_tostring=!0,n.prototype.leading_zeros=0,n.prototype.trailing_zeros=0,n.prototype.coordinate_separator="",n.prototype.zip_space_before_command=!0,n.prototype.zip_space_after_command=!0,n.prototype.zip_space_after_z=!0,n.prototype.zip_space_before_minus=!0,n.prototype.zip_space_before_dot=!1,n.prototype.zip_space_use_e=!1,n.prototype.zip_remove_repeats=!0,n.prototype.zip_remove_l_after_m=!1,n.prototype.parseOutputFormat=function(t){if(typeof t=="string"){var i;i=t.match(/[+-]/),i&&(t+=i[0]==="+"?"BAZMDERL":"bazmderl"),i=t.match(/[Bb]/),i&&(this.zip_space_before_command=i[0]==="B"),i=t.match(/[Aa]/),i&&(this.zip_space_after_command=i[0]==="A"),i=t.match(/[Zz]/),i&&(this.zip_space_after_z=i[0]==="Z"),i=t.match(/[Mm]/),i&&(this.zip_space_before_minus=i[0]==="M"),i=t.match(/[Dd]/),i&&(this.zip_space_before_dot=i[0]==="D"),i=t.match(/[Ee]/),i&&(this.zip_space_use_e=i[0]==="E"),i=t.match(/[Rr]/),i&&(this.zip_remove_repeats=i[0]==="R"),i=t.match(/[Ll]/),i&&(this.zip_remove_l_after_m=i[0]==="L"),i=t.match(/\s?,\s?/),i&&(this.coordinate_separator=i[0]),i=t.match(/(?:0*\.[0X]*|0+)/),i&&(i=i[0].split("."),this.leading_zeros=i[0].length,i.length>1&&(this.precision=Math.min(i[1].length,20),this.trailing_zeros=i[1].split("X")[0].length))}};function b(t,i){for(;t.length<i;)t="0"+t;return t}function z(t,i){for(;t.length<i;)t+="0";return t}return n.prototype.numToString=function(t,i){t=d(t,this.precision);var h=i||this.zip_space_before_minus&&t<0?"":" ",u="";t<0&&(u="-",t=-t);var l=t.toFixed(this.precision).split(".");if(typeof l[1]!="string"&&(l[1]=""),l[1]=l[1].replace(/0*$/,""),l[0]==="0"&&l[1]&&(l[0]=""),this.zip_space_use_e){var c,r;l[1]?l[0]||(r=+l[1]+"e"+-l[1].length,r.length<l[1].length+1&&(l[0]=r,l[1]="")):(r=l[0],c=r.match(/0*$/)[0].length,c>2&&(l[0]=r.slice(0,-c)+"e"+c))}else l[0]=b(l[0],this.leading_zeros),l[1]=z(l[1],this.trailing_zeros);return h+u+l[0]+(l[1]?"."+l[1]:"")},n.prototype.coordsToString=function(t,i,h){return this.numToString(t,h)+this.coordinate_separator+this.numToString(i,this.coordinate_separator)},n.prototype.toString=function(t,i,h){typeof t=="boolean"&&(t=t?"+":"-"),typeof t=="string"&&this.parseOutputFormat(t),h=!!h,typeof i>"u"&&(i=this.normalize_before_tostring),i&&this.normalize(),this.doTransform().round(this.precision);for(var u="",l=!1,c,r=0,f=h&&this.hasErrors()?this.errs[0].segment-1:this.segments.length,m=this.segments[0],g=null;r<f;g=!this.zip_remove_l_after_m||c!=="m"?m[0]:m[0]==="M"?"L":"l",m=this.segments[++r])switch(c=m[0].toLowerCase(),l=!this.zip_remove_repeats||m[0]!==g,l&&(this.zip_space_before_command||(u+=" "),u+=m[0],(!this.zip_space_after_command&&c!=="z"||c==="z"&&!this.zip_space_after_z&&this.zip_space_before_command)&&(u+=" ")),c){case"h":case"v":u+=this.numToString(m[1],l);break;case"a":u+=this.coordsToString(m[1],m[2],l)+this.numToString(m[3])+this.coordsToString(m[4],m[5])+this.coordsToString(m[6],m[7]);break;case"z":break;default:for(var y=1,C=m.length,Y=l;y<C;y+=2,Y=!1)u+=this.coordsToString(m[y],m[y+1],Y);break}return this.zip_space_before_dot&&this.leading_zeros===0?u.trim().replace(/(\.\d+) 0?(?=\.)/g,"$1"):u.trim()},n.prototype.toBox=function(){var t=s();if(this.segments.length===0)return t;var i=this.copy().abs().unarc().unshort().doTransform();return i.iterate(function(h,u,l,c){switch(h[0]){case"H":t.addX(h[1]);break;case"V":t.addY(h[1]);break;case"M":case"L":t.addX(h[1]),t.addY(h[2]);break;case"Q":t.addXQ([l,h[1],h[3]]),t.addYQ([c,h[2],h[4]]);break;case"C":t.addXC([l,h[1],h[3],h[5]]),t.addYC([c,h[2],h[4],h[6]]);break}}),t.minX=d(t.minX,this.precision),t.minY=d(t.minY,this.precision),t.maxX=d(t.maxX,this.precision),t.maxY=d(t.maxY,this.precision),t},n.prototype.toBoxString=function(t){this.parseOutputFormat(t);var i=this.toBox();return[this.numToString(i.minX,!0),this.numToString(i.minY,!0),this.numToString(i.width(),!0),this.numToString(i.height(),!0)].join(" ")},n.prototype.inbox=function(t){return typeof t!="string"&&(t=Array.prototype.join.call(arguments," ")),this.matrix(this.toBox().inboxMatrix(t)),this},K=n,K}var Z,ct;function zt(){return ct||(ct=1,Z=yt()),Z}var kt=zt(),U=_t(kt);function q(e,p,o="xMid",_="YMid"){if(p.width<=0||p.height<=0)return{x:e.x,y:e.y,width:0,height:0,scale:0};if(e.width<=0||e.height<=0)return{x:e.x,y:e.y,width:0,height:0,scale:0};const a=e.width/e.height,s=p.width/p.height;let n,w,v;s>a?(n=e.width/p.width,w=e.width,v=p.height*n):(n=e.height/p.height,w=p.width*n,v=e.height);let d,x;switch(o){case"xMin":d=e.x;break;case"xMax":d=e.x+e.width-w;break;default:d=e.x+(e.width-w)/2;break}switch(_){case"YMin":x=e.y;break;case"YMax":x=e.y+e.height-v;break;default:x=e.y+(e.height-v)/2;break}return{x:Math.round(d*1e3)/1e3,y:Math.round(x*1e3)/1e3,width:Math.round(w*1e3)/1e3,height:Math.round(v*1e3)/1e3,scale:Math.round(n*1e3)/1e3}}let k=null,E=null,T=null,V=null,ut;const Yt=(e,p,o,_,a,s,n=!0)=>new Promise((w,v)=>{if(s&&s.aborted)return console.log("[CustomPathWidget.WORKER] generatePreview aborted"),v(null);const d=()=>{console.log("[CustomPathWidget.WORKER] generatePreview.onAbort called"),cancelAnimationFrame(ut),v(null)};if(s&&s.addEventListener("abort",d),e===null)return;gt(o);const x=R(o),M=x.width,b=x.height,z={width:M,height:b},t=z.width/z.height,i=a.width/a.height,h=t>i?{width:a.width,height:a.width*z.height/z.width}:{height:a.height,width:a.height*z.width/z.height},u=h.width/z.width;console.log("[CustomPathWidget.WORKER] generatePreview started",{printAreaProps:o,printSize:z,totalSize:a,obj_size_scaled:h,scaleFactor:u}),e.canvas.width=Math.round(h.width),e.canvas.height=Math.round(h.height);const l={width:x.width*u,height:x.height*u},c=l.width,r=l.height,f={width:c,height:r};console.log("[CustomPathWidget.WORKER] generatePreview totalSizePx",{printSize:z,totalSize:a,totalSizePx:f}),e.save(),e.strokeStyle="blue",e.lineWidth=1;const m=o.path;if(!W(m)){v(null);return}let g=U(m).inbox(`0 0 ${f.width} ${f.height} meet xMinYMin`).toString(),y=new Path2D(g);e.setLineDash([5,5]),e.fillStyle="rgba(52, 202, 15, 0.1)",e.fill(y),e.stroke(y),e.restore(),e.save(),e.beginPath(),e.rect(0,0,h.width,h.height),e.setLineDash([5,5]),e.stroke(),e.restore(),w(null)});self.onmessage=function(e){console.log("[CustomPathWidget.WORKER] onmessage",e.data);const p=e.data;switch(p.type){case"initCanvas":console.log("[CustomPathWidget.WORKER] initCanvas",e.data.type,p.bitmap);const o=p.canvas;o&&(k=o.getContext("2d"),E=new OffscreenCanvas(0,0).getContext("2d"),p.bitmap&&(T=p.bitmap),postMessage({action:"canvas-init-callback",success:!0}));break;case"stopAnimation":break;case"renderPath":if(k!==null){p.bitmap&&(T=p.bitmap);const h={width:e.data.totalSize?.width??0,height:e.data.totalSize?.height??0};k.canvas.width=h.width,k.canvas.height=h.height;const u=R(e.data.printAreaProps),l={x:0,y:0,width:h.width,height:h.height},c=q(l,u,"xMin","YMin"),r={x:0,y:0,width:e.data.imageProps.width,height:e.data.imageProps.height},f=q(r,u,"xMin","YMin"),m={width:r.width/f.scale,height:r.height/f.scale};m.width=m.width*e.data.zoom,m.height=m.height*e.data.zoom;const g=r.width/m.width;q({...m,x:0,y:0},h,"xMin","YMin");const y={width:h.width/c.scale,height:h.height/c.scale};console.log("renderPath sizes: ",{_image_scale:g,image_size_units:m,image_container:r,body_size_units:y,boundaries:u});const C=-(e.data.topLeft.x+e.data.mouseMoveDelta.x)*f.scale,Y=-(e.data.topLeft.y+e.data.mouseMoveDelta.y)*f.scale,S={x:0,y:0,width:m.width,height:m.height},P=q(S,h,"xMin","YMin");console.log("renderPath image_fit",{image_body_fit:P,image_fit5:f,image_size_units:m,body_size_units:y,image_container:r}),k.drawImage(T,C,Y,y.width*g,y.height*g,0,0,h.width,h.height);const L=e.data.printAreaProps.path;if(!W(L))return;let X=U(L).inbox(`0 0 ${u.width} ${u.height} meet xMinYMin`).scale(c.scale).toString();console.log("renderPath started",{boundaries:u,container:l,path_fit:c}),console.log("renderPath transformed",{transformed:X,path_fit:c}),k.save();let ft=new Path2D(X);k.strokeStyle="green",k.setLineDash([5,5]),k.fillStyle="rgba(11, 88, 255, 0.14)",k.fill(ft),k.stroke(ft),k.restore(),k.save(),k.strokeStyle="blue",k.lineWidth=1,k.setLineDash([5,5]),k.globalAlpha=1,k.strokeRect(0,0,c.width,c.height),k.restore()}break;case"drawBitmap":try{V.abort()}catch{}V=new AbortController,k!==null&&(ut=requestAnimationFrame(()=>Yt(E,e.data.units,e.data.printAreaProps,T,e.data.totalSize,V.signal).then(u=>{new Date().getTime();const l=R(e.data.printAreaProps),{width:c,height:r}=E.canvas;console.log("[CustomPathWidget.WORKER] generatePreview boundaries",l,{obj_width_px:c,obj_height_px:r},e.data.totalSize),k.canvas.width=e.data.totalSize.width,k.canvas.height=e.data.totalSize.height,Promise.all([E.canvas.convertToBlob({type:"image/png"})]).then(([f])=>{console.log("[CustomPathWidget.WORKER1] Blobs ready:",f);const g={url:URL.createObjectURL(f),width:c,height:r};return postMessage({type:"export-object-png",res:g}),Promise.all([createImageBitmap(f)])}).then(([f])=>{const m={x:0,y:0,width:e.data.totalSize.width,height:e.data.totalSize.height};k.save(),k.fillStyle="rgba(230, 116, 10, 0.5)",k.fill(),k.restore();const g=q(m,l,"xMin","YMin");console.log("[CustomPathWidget.WORKER] calculateInboxFit result",g,l,e.data.totalSize),k.save(),k.strokeStyle="black",k.lineWidth=1,k.setLineDash([5,5]),k.globalAlpha=1,k.strokeRect(g.x,g.y,g.width,g.height),k.drawImage(f,0,0,f.width,f.height,g.x,g.y,g.width,g.height),k.restore()})}).catch(u=>console.log("[CustomPathWidget.WORKER] generatePreview exception cougth",u))));break;case"dragFinished":console.log("dragFinished",e.data);const _={width:e.data.imageProps.width,height:e.data.imageProps.height},a=R(e.data.printAreaProps),s={x:0,y:0,width:_.width,height:_.height},n=q(s,a,"xMin","YMin");console.log("dragFinished: image_fit",{image_fit:n,boundaries:a,container:s});const v=new OffscreenCanvas(0,0).getContext("2d"),d={width:_.width/n.scale,height:_.height/n.scale},x={width:d.width*e.data.zoom,height:d.height*e.data.zoom},M=_.width/x.width,b={width:a.width*M,height:a.height*M};console.log("[CustomPathWidget.WORKER1] dragFinished:",{scaled_canvas_size:b,_zoomed_dpu:M,image_size_units:d,image_size_units_zoomed:x}),v.canvas.width=Math.round(b.width),v.canvas.height=Math.round(b.height),v.save(),v.strokeStyle="blue",v.lineWidth=5;const z=e.data.printAreaProps.path;if(!W(z))return;let t=U(z).inbox(`0 0 ${a.width} ${a.height} meet xMinYMin`).scale(M).toString(),i=new Path2D(t);v.clip(i),v.drawImage(T,-e.data.topLeft.x*n.scale,-e.data.topLeft.y*n.scale,b.width,b.height,0,0,b.width,b.height),v.restore(),Promise.all([v.canvas.convertToBlob({type:"image/png"})]).then(([h])=>{console.log("[CustomPathWidget.WORKER1] Blobs ready:",h);const l={url:URL.createObjectURL(h),width:b.width,height:b.height};postMessage({type:"export-object-png",res:l})});break}}})();
